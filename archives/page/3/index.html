
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="yolynn">
    <title>Archives - yolynn</title>
    <meta name="author" content="yolynn">
    
    
        <link rel="icon" href="http://yolynn.com/assets/images/head.png">
    
    
    <meta name="description" content="云在青天水在瓶 - 幽灵鸟">
<meta property="og:type" content="blog">
<meta property="og:title" content="yolynn">
<meta property="og:url" content="http://yolynn.com/archives/page/3/index.html">
<meta property="og:site_name" content="yolynn">
<meta property="og:description" content="云在青天水在瓶 - 幽灵鸟">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yolynn">
<meta name="twitter:description" content="云在青天水在瓶 - 幽灵鸟">
    
    
        
    
    
        <meta property="og:image" content="http://yolynn.com/assets/images/head.png"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox-thumbs.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css" type="text/css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">yolynn</a>
    </h1>
    
        
            <a  class="header-right-icon "
                href="/#about">
        
        
            <i class="fa fa-lg fa-head.png"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/head.png"/>
            </a>
            <span class="sidebar-profile-name">yolynn</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/yolynn-bird" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://weibo.com/zxl20zxl" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
                    <span class="sidebar-button-desc">global.weibo</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://stackoverflow.com/users/2662962/yolynn" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://twitter.com/zxl20zxl" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://www.instagram.com/yolynn.zxl" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-instagram"></i>
                    <span class="sidebar-button-desc">global.instagram</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://dribbble.com/yolynn" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-dribbble"></i>
                    <span class="sidebar-button-desc">global.dribbble</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="http://yolynn.com/2010/04/22/weixin/"
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-weixin"></i>
                    <span class="sidebar-button-desc">global.weixin</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://www.zhihu.com/people/yolynn" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-flickr"></i>
                    <span class="sidebar-button-desc">global.zhihu</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto://zxl20zxl@gmail.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/23/sumarry_2015/">
                            2015我的年度总结
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-01-23T16:15:02+08:00">
	
		    Jan 23, 2016
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="background">background</h2><blockquote>
<p>年前就准备着手写这个总结了，却一直拖着，想必是自己的拖延症越来越严重了，今天已经是2016年2月22日，干脆扔掉纠结，硬着头皮也要完成这篇文章。</p>
<p>2015对我来说是非常重要的一年，工作的第三个年头，从传统软件公司转入互联网公司，让自己在风口中也能吹到一点风，从后端转入前端，熬夜加班上线已不常见，离开深圳来到广州，生活气息更加浓厚的广州成为毕业后呆的第二个城市。</p>
<p>整个2015，可以从几个方面来概括：工作、学习、生活、规划</p>
</blockquote>
<ol>
<li><p>工作，年初有幸被派到上海银联出差一周，那时候上海天气还比较寒冷，我们就边工作边从天气开始聊天，虽然只有短短一周时间，但是无论是新认识的人还是第一次去的地方，都给我很深的触动，心底里也深深的喜欢上这座城市，回深之后的工作相对之前变数更大，公司服务器经常受到不明的攻击，网站和客户端更新次数也越发频繁，熬夜的次数也越来越多，记得有一次我开发的一个秒杀活动页，由于后台上线问题一直到隔天下午才下班，让我深深觉得工作效率才是公司需要急需解决的问题，时间来到年中的时候我决定过来现在的公司，新公司给我干的活儿少了很多，只需要单纯的做好手上的事情就足够，开始还真有点不适应，因为很多系统由于权限问题无法直接访问，只能找测试帮忙，所有事情都要按流程走，渐渐的我也明白这也只是时间问题，很快我到这个公司也快有一年的时间，也并不会觉得现在的工作简单，因为现在的侧重点是在追求其深度上，而之前是一直在追求广度。</p>
</li>
<li><p>学习，其实前面有两篇文章已经列出了我在2015年看过的书和看过的视频，大概可以囊括我在2015年的整个学习历程，除此之外还想补充下，虽然是个失败的结果，但是还是对我自己的学习方法增加了信心，从8月份开始一直在备战考研，其实有很多课程在大学并没有怎么认真学习过，但是就这这几个月的时间里，曾经觉得考研是多么遥远的一件事情，事实上自己做过了才发现不过如此。</p>
</li>
<li><p>生活，安逸的生活并不是没有想过，但是来了深圳，去了上海，来了广州，却觉得再也回去不了，安逸的生活可能根本不是我想要的。</p>
</li>
<li><p>规划，记得2014年初年度财务计划，2015年竟然都没有实现，所以2016年很重要的一条规划是要学会理财。</p>
</li>
</ol>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/01/23/sumarry_2015/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/16/vedio_2015/">
                            2015我的视频教程
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-01-16T20:14:02+08:00">
	
		    Jan 16, 2016
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="background">background</h2><blockquote>
<p>看书是学习的一大途径，但是现代社会如此浮躁，公开课、慕课等等在线教育平台的兴起，只要利用好在线教育资源，学习效率和知识摄取也很好</p>
</blockquote>
<h2 id="vedio_list">vedio list</h2><blockquote>
<p>特别指出这些事值得收藏，值得多次观看</p>
</blockquote>
<ol>
<li><p>慕课网</p>
<ul>
<li>《JavaScript深入浅出》   <em>:Bosn</em></li>
<li>《Linux C语言指针与内存》 <em>:DavidChin</em>  </li>
<li>《Linux C语言编程基本原理与实践》 <em>:DavidChin</em></li>
<li>《玩儿转Swift》    <em>:liuyubobobo</em></li>
<li>《进击Node.js基础》    <em>:Scott</em></li>
<li>《Grunt-beginner前端自动化工具》    <em>:Materliu</em></li>
<li>《Canvas玩转图像处理》    <em>:liuyubobobo</em></li>
</ul>
</li>
<li><p>百度传课网</p>
<ul>
<li>《编译原理》 <em>:西安交通大学</em></li>
</ul>
</li>
<li><p>网易云课堂</p>
<ul>
<li>《Go编程基础》 <em>:无闻</em></li>
<li>《数据结构和算法》 <em>:小甲鱼</em></li>
</ul>
</li>
<li><p>网易公开课</p>
<ul>
<li>《哈佛大学公开课：计算机cs50》</li>
<li>《麻省理工学院公开课：算法导论》</li>
<li>《斯坦福大学公开课：编程范式》</li>
<li>《斯坦福大学公开课：编程方法学》</li>
</ul>
</li>
</ol>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/01/16/vedio_2015/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/16/read_2015/">
                            2015我的读书清单
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-01-16T16:14:02+08:00">
	
		    Jan 16, 2016
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="backgroud">backgroud</h2><blockquote>
<p>2015年对于我来说是技术转型的重要一年，这一年收获颇多，当然读过很多很好很有用的书籍，这里想记录下来，好了废话少说，上清单：</p>
</blockquote>
<h2 id="book_list">book list</h2><ol>
<li><p>算法系</p>
<blockquote>
<p>算法和数据结构本身就是编程的灵魂，所以基础还需稳扎稳打</p>
<ul>
<li>《算法导论》<em>：相信大家都很熟悉这本书，大学开设过这门课</em></li>
<li>《数据结构(C语言版)》<em>：严蔚敏_吴伟民著，同样在大学开设过</em></li>
<li>《算法 第4版》<em>：谢路云 译(Java描述)，强烈推荐这本，从前看算法都是C描述，这本Java描述更加生动具体</em></li>
<li>《数据结构与算法分析-C语言描述》<em>：相对算法导论这本更好理解，歪果仁著</em></li>
</ul>
</blockquote>
</li>
<li><p>重构系</p>
<blockquote>
<p>当手上的代码积累到一定程度，某一天回过头再去看的时候抑或会骂一句“shit”，需要好好思考重构</p>
<ul>
<li>《编程之美》 <em>：看的不是很仔细，但是看后觉得重构也是一件非常重量级的事情</em></li>
<li>《代码之美》 <em>：比较上本更好理解和实用</em></li>
<li>《重构_改善既有代码的设计》</li>
</ul>
</blockquote>
</li>
<li><p>语言系</p>
<blockquote>
<p>切记切记语言只是工具，个人觉得大部分语言书籍就当语法说明书看看好了，要想精通某门工具，靠的是实践</p>
<ul>
<li>《C程序设计(第四版)》 <em>：谭浩强，又见教材系</em></li>
<li>《C专家编程》 <em>：C的补充书籍</em></li>
<li>《The C programming language》 <em>：看C语言的书从来不嫌多</em></li>
<li>《Objective-C程序设计（第4版）》 <em>：OC语法说明书</em></li>
<li>《The Swift Programming Language》 <em>：Swift语法说明书</em></li>
<li>《node入门》<em>：nodejs入门说明书，很简短只有28页</em></li>
<li>《让你不再害怕指针》<em>：同样很简短只有29页</em></li>
<li>《linux命令手册》</li>
</ul>
</blockquote>
</li>
<li><p>设计模式系</p>
<blockquote>
<p>掌握了各种语言怎么用，还得知道怎么设计语言最好的使用方式</p>
<ul>
<li>《设计模式之禅完整版》 <em>：秦晓波，其实还没怎么看</em></li>
<li>《HeadFirst_设计模式》 <em>：这本书没什么好解释的，看多少遍也不嫌多</em></li>
</ul>
</blockquote>
</li>
<li><p>面试系</p>
<blockquote>
<p>追其面试根本，一个高质量的面试往往是考研算法和经验，二者缺一不可</p>
<ul>
<li>《JAVA面试汇总》</li>
<li>《Iterview _Points》</li>
<li>《100题系列by_July》</li>
<li>《程序员面试宝典》</li>
<li>《剑指offer》</li>
<li>《十五个经典算法研究与总结、目录+索引》</li>
</ul>
</blockquote>
</li>
<li><p>游戏系</p>
<blockquote>
<p>有一段时间在cocos2dx里玩耍</p>
<ul>
<li>《制作自己的《捕鱼达人》》 <em>：看这本书大概可以做一个属于自己的demo了</em></li>
<li>《Cocos2d-x高级开发教程》</li>
<li>《Cocos2d-x手机游戏开发》</li>
<li>《Cocos2d-x游戏开发之旅》</li>
<li>《Lua程序设计中文第二版》</li>
<li>《Lua编程(programming in lua)》</li>
</ul>
</blockquote>
</li>
<li>产品系<blockquote>
<p>其实这里面有部分并没有看过，但是都是很高质量的书籍，先列出来</p>
<ul>
<li>《结网》</li>
<li>《人人都是产品经理》</li>
<li>《乔布斯》</li>
<li>《写给大家看的设计书》</li>
</ul>
</blockquote>
</li>
<li>编译系<blockquote>
<p>当学习了多门语言之后，回头猛然的发现万变不离其中的是编译，虽然没有机会写编译器，但是很想搞懂这么多语言，是怎么一层一层指示着硬件呢，这个系列也是我正在看的</p>
<ul>
<li>《编译原理》<em>：业内又名龙书</em></li>
<li>《编译器工程》<em>：建议先看这本书，再自己决定看龙书系列</em></li>
</ul>
</blockquote>
</li>
<li>is reading<blockquote>
<p>除了编译原理，手上正在看的书籍还有一些整理在下面</p>
<ul>
<li>《JavaScript DOM编程艺术》</li>
<li>《JavaScript 高级程序设计》</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="summary">summary</h2><blockquote>
<p>大概数了一下2015年累计看了35本书，事实上2015还有大概四个月时间是被耽搁掉了,所以计划下2016年阅读书籍数为60本，再一点观察了下book list发现技术书籍以外的书看太少，这一点是要改善的。</p>
</blockquote>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/01/16/read_2015/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/04/my_resource/">
                            我的灵感之源
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-01-04T18:15:02+08:00">
	
		    Jan 04, 2016
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h6 id="background">background</h6><blockquote>
<p>我的灵感之源，主要是收集了我微博中的内容，有兴趣的同学可以去我的微博翻看更多。</p>
</blockquote>
<ul>
<li><p>目测微博上传图片时，每张图片各要请求一次接口，上传基本信息并获取上传路径和读取路径，之后才会开多线程上传图片的进制码，至于开几个线程应该有套算法，相比之下instagram每次限制只能传一张图片就简单了很多</p>
</li>
<li><p>Swift的元组和闭包的引入，使其更加方便运用函数响应式编程，在未来硬件多核更进步发展后，这种编程范式会不会取代oo呢？</p>
</li>
<li><p>要做一些图片处理的有趣应用，例如放大、截图、移动、水印、滤镜、制作等，首先当然需要一块画布了，html5-canvas提供的函数已经很强大了，同样在iOS平台也有很方便和成熟的API，其实最核心还是RGB色值算法</p>
</li>
<li><p>游戏后端需要高频次高速度的数据层，内存数据库、事务日志的redo和undo、查询数据表切片这些手段，其实开发应用也可以借鉴这些</p>
</li>
<li><p>图形手势一笔画的识别算法被简单切割成5步：打点resample、校准centro、移动translate、缩放scale、旋转rotate，多数复杂算法亦是如此，大数据亦是如此，切片确实简化的钥匙</p>
</li>
<li><p>Scrum的三大角色：Product Owner、Scrum Master、Scrum Team，强调相互之间的对等关系和自组织，并定义了四大事件：计划会议、每日站立会议、评审会议、回顾会议，最终在一个月(可变)的周期内实行Sprint，获取Scrum！</p>
</li>
<li><p>传统编译器GNU及其客户端gcc，苹果大力支持的LLVM及其客户端clang，再有jvm，有Google v8 .etc，这些编译器或者虚拟机或者引擎，从另一个角度映射了每门语言的特性</p>
</li>
<li><p>Swift相对于OC大大弱化了runtime这块的实现，而新加入的反射太弱，期待后续版本能有golang的reflect的强大表现</p>
</li>
<li><p>因为每种设备的二进制机器语言执行不一致，为了实现跨平台，各种编译器、虚拟机、引擎都一一出现，但是万变不离其中的是从低级到高级一层层封装，或者从高级到低级的一层层解释，比如词法分析(预编译器)-&gt;语法分析-&gt;语义分析-&gt;中间代码(汇编器)-&gt;优化-&gt;目标代码-&gt;链接(链接器)-&gt;加载器</p>
</li>
<li><p>编译器对中间代码（汇编四元式）的优化重心应放在循环体上，这样在时间和空间复杂度上才有质的降低</p>
</li>
<li><p>一直诟病html5性能差，这个框架重那个框架慢，其实它们差距并不太大，前端render过程一般也会在百毫秒级完成，而真正影响用户体验的应该是手机移动网络和基站通信时间，如果从网络这块（当然除开基站这块）下手优化，比如利用减少请求数、减小传输体积、利用缓存、缩短路径、合理安排请求顺序等等。</p>
</li>
<li><p>docker run image 基于container和image的docker给开发者带来无限的便捷，但其诟病的网络，和npm遇到了同样的问题。</p>
</li>
<li><p>GCD更底层，也更容易死锁，如在当前队列使用同步函数添加任务，该同步函数会阻塞他后面的任务，而添加的任务符合队列FIFO的原则，它也在等待后面的任务执行，这样相互等待即死锁，解决思路：1，同步转异步，解放阻塞；2，任务放进并发队列或不同队列</p>
</li>
<li><p>instance’s isa -&gt; class struct {ivars;methodlist;cachelist;protocollist}’s isa -&gt; meta class {class method}</p>
</li>
<li><p>缓存机制应让内存缓存和磁盘缓存结合使用，而且都要有总数量、总消耗、总大小上限，自我轮询检查，遵循LRU淘汰算法，内存缓存还需监听应用内存警告或者后台使用，磁盘缓存则可以根据文件大小选择数据库或者文件方式</p>
</li>
<li><p>对于APP启动即崩的情况，可以巧妙的在沙盒中存储一个计数器，每次启动计数器加1，正常退出或正常启动15秒后初始化为0，那么当计数器大于等于2的情况即可断定启动即崩，在这些情况下可以根据需求清空数据或者运行热不定来尝试修复（淘宝连续崩3次即清空了数据）</p>
</li>
<li><p>保证客户端网络请求安全的三个方案：1，后端传送秘钥加密密文和明文，前端使用密文加密匹配密文，符合则成功，这种方案易被黑掉秘钥；2，使用https，这种方案成本高；3，使用RSA非对称加密，服务端私钥加密，客户端公钥解密，匹对解密后密文，一致则成功，在保证服务端的私钥不被黑走的情况下安全</p>
</li>
<li><p>一个晚上的折腾，发现JSPatch1.0三个问题：1，在invocation函数中与aspect冲突，aspect官方做出解释；2，调用super的自定义函数会崩，原因可能是1.0版本过旧导致；3，二维数组在js中的翻译，待bang大神回复</p>
</li>
<li><p>concurrent thread执行很多个block任务时，如果给其中一个block加锁会导致系统多开线程抢占资源从而影响到主线程，这时候可以利用serial queue连续队列线程池解决，同时限制队列中线程个数范围，一般是（0，32）</p>
</li>
<li><p>图片异步展示的过程，其实也是利用了一次缓存机制，首先以url为key依次从内存缓存、磁盘缓存中寻找value，如果未找到，则启动下载线程，成功后展示并将图片以value值存入内存缓存或磁盘缓存，以供下次快速加载</p>
</li>
<li><p>想要彻底精通某个知识点，仅仅看博客了解是不够的，一定要在看博客的基础上动手实践，深究源码，这样你才能领悟到这篇博客的精髓，也就消化了这个知识点，而且这个道理在所有的事情中都是通用的，纸上谈兵终究还是虚</p>
</li>
<li><p>MVVM将MVC的VC合二为一成View层，C中的业务逻辑、数据计算全部交给VM来完成，它只做View的展示和VM与View的双向绑定工作，因此大大解放了C的臃肿，但是涉及到大量计算而少量View操作的模块是不是也适用MVVM呢？</p>
</li>
<li><p>线程保活可使用RunLoop，新开子线程手动创建对应的runloop，并为其添加port，调用cf run，同时在对应的线程结束时调用cf stop，可以确保runloop的正确启动和关闭，切记启动不能使用run 函数</p>
</li>
<li><p>CADisplaylink作为一个timer，GPU渲染一帧，它就调用一次，结合它的timestamp属性可以巧妙计算出当前的FPS</p>
</li>
<li><p>将layer的绘制封装为一个个异步任务，提交到事务管理器上，当observe 到CPU的wait和exit状态时，开始异步执行渲染过程，并将结果返回给主线程</p>
</li>
<li><p>vuejs吸收了React插件化和Angular模板指令双向绑定的优点，通过标签template script style 区分脚本，集中到.vue文件，并结合webpack打包工具在打包时拆分为浏览器需要脚本，是一个非常值得入手的MVVM框架工具</p>
</li>
<li><p>SVN依赖中央服务器做集中式的版本控制管理，所有的版本交互工作以及大部分命令都必须在连接服务器的基础上执行；git采用分布式版本控制管理，并不强行依赖中央服务器（可有可无），相当于每个接入者本身就是自己的服务器，所以git大部分命令都可以在未联网情况下执行，所以速度更快，效率更高</p>
</li>
<li><p>iOS崩溃分为两种：基于堆栈错抛出的NSException和系统级别操作抛出的unix信号，前者调试阶段可以借助xcode控制台打印错误堆栈信息直接定位到错误代码位置，生产阶段则可通过异常捕获上传错误地址信息再结合.dSYM文件中的符号表即可定位错误位置，而后者捕获难度较大，系统只简单的提供几个信号以供订阅</p>
</li>
<li><p>基于传输层协议TCP实现的常用应用层协议有HTTP FTP SMTP，它们是面向连接的（三次握手，四次挥手），也是可靠的；而基于传输层UDP的应用层协议HTTP XMPP POP是非面向链接，非可靠的协议</p>
</li>
<li><p>HTTP 的request和response头信息在遵循w3c的基础上，通过\r\n隔离键值对，遍历解析时只需命中到流结束和\r\n</p>
</li>
</ul>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/01/04/my_resource/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/12/30/ios_animation/">
                            iOS动画基础到进阶
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-12-30T18:15:02+08:00">
	
		    Dec 30, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="学习iOS动画需要会什么？">学习iOS动画需要会什么？</h2><p>所谓动画，也就是一幅一幅图片在短时间内连续播放的效果，动画和电影一般也就<strong>24帧/s</strong>，也就是说每秒播放24张图片，那么肉眼看到的就是连续的画面效果。动画分为两大类：</p>
<ol>
<li>逐帧动画：<strong>一帧一帧</strong>显示动画的图像序列</li>
<li>关键帧动画：只需指定<strong>一些关键帧</strong>，让计算机计算出每一帧图像</li>
</ol>
<p>其中视图的状态包括<strong>位置、透明度、旋转角度、形状、颜色</strong>等的变化</p>
<h2 id="iOS动画是什么？">iOS动画是什么？</h2><p>iOS动画基于CALayer，使用CoreAnimation开发动画的本质就是将CALayer中的内容转化为<strong>位图</strong>而供硬件操作</p>
<h4 id="工作流">工作流</h4><p><img src="https://www.processon.com/chart_image/58592f63e4b0db9f2e1317d7.png" alt=""></p>
<h4 id="渲染机制">渲染机制</h4><p><img src="https://www.processon.com/chart_image/58593326e4b0db9f2e1359a4.png" alt=""><br>动画和视图的渲染其实是在另外一个进程BackBoard做的</p>
<h4 id="渲染优化">渲染优化</h4><p><img src="https://www.processon.com/chart_image/585938fce4b0db9f2e13b5e9.png" alt=""></p>
<h4 id="实现方式">实现方式</h4><h6 id="UIImageView动画">UIImageView动画</h6><p>逐帧动画，效果取决于animationImages的<strong>图片细度和数量</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#35774;&#32622;&#21160;&#30011;&#24103;&#10;fishAni.animationImages=[NSArray arrayWithObjects:[UIImage imageNamed:@&#34;1.jpg&#34;],[UIImage imageNamed:@&#34;2.jpg&#34;],[UIImage imageNamed:@&#34;3.jpg&#34;],nil];</span><br></pre></td></tr></table></figure>
<h6 id="UIView动画">UIView动画</h6><p>关键帧动画，实现<strong>View的属性变化</strong>产生的效果</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UIView animateWithDuration:&#60;#(NSTimeInterval)#&#62; animations:&#60;#^(void)animations#&#62;];</span><br></pre></td></tr></table></figure>
<h6 id="CoreAnimation">CoreAnimation</h6><p><img src="https://www.processon.com/chart_image/5858db28e4b0db9f2e0ae2ee.png" alt=""></p>
<p>CoreAnimation分为三大类：</p>
<ol>
<li>CAPropertyAnimation(属性动画，<strong>控制动画属性</strong>设置动画)<ul>
<li>CABasicAnimation : 只有初始状态和结束状态，<strong>两个关键帧</strong></li>
<li>CAKeyframeAnimation : 通过<strong>多个状态</strong>控制</li>
</ul>
</li>
<li>CAAnimationGroup(动画组)<ul>
<li>一种组合模式设计，所有效果并发执行</li>
</ul>
</li>
<li>CATransition(转场动画) <ul>
<li>通过滤镜进行动画效果设置</li>
</ul>
</li>
</ol>
<h2 id="为什么要用iOS动画？">为什么要用iOS动画？</h2><h4 id="贝塞尔曲线">贝塞尔曲线</h4><p>数学曲线：起始点、终止点、控制点，通过调整控制点，贝塞尔发生变化</p>
<h4 id="CAShapeLayer">CAShapeLayer</h4><p>继承于CALayer，通过矢量图（非bitmap）绘制图层类，常与UIBezierPath配合使用，它的优点：</p>
<ol>
<li>渲染快</li>
<li>内存消耗少</li>
<li>不会被图层边界裁剪掉</li>
<li>不会出现像素化</li>
</ol>
<h4 id="CAReplicatorLayer">CAReplicatorLayer</h4><p>可以复制子层的Layer，复制出来的和原来的子layer拥有形同的动效</p>
<h2 id="iOS动画怎么用？">iOS动画怎么用？</h2><p>举两个常见的🌰</p>
<h4 id="环形进度条">环形进度条</h4><p>效果：</p>
<p>构成：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/943491-35bd9029f967d8d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>这两个环依赖于：贝塞尔曲线 、 CAShapeLayer</p>
<ol>
<li>利用贝塞尔曲线绘制底色环路径</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIBezierPath *path=[UIBezierPath bezierPathWithArcCenter:CGPointMake(50,50) radius:25 startAngle:CATDegreesToRadians(_startAngle) endAngle:CATDegreesToRadians(_endAngle) clockwise:YES];</span><br></pre></td></tr></table></figure>
<ol>
<li>把路径赋给CAShapeLayer，并加入self.layer显示</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_trackLayer=[CAShapeLayer layer];&#10;_trackLayer.frame=self.bounds;&#10;_trackLayer.fillColor = [UIColor clearColor].CGColor;&#10;_trackLayer.strokeColor = _curveBgColor.CGColor;&#10;_trackLayer.lineCap = kCALineCapRound;&#10;_trackLayer.path=path.CGPath;&#10;[self.layer addSublayer:_trackLayer];</span><br></pre></td></tr></table></figure>
<ol>
<li>进度环的实现和底色环相似，并结合CATransaction实现动画</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CATransaction begin];&#10;[CATransaction setDisableActions:!animated];&#10;[CATransaction setAnimationTimingFunction:[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn]];&#10;[CATransaction setAnimationDuration:1];&#10;_progressLayer.strokeEnd=progress;&#10;[CATransaction commit];</span><br></pre></td></tr></table></figure>
<p>具体工程参见：<a href="https://github.com/CatchZeng/CATCurveProgressView" target="_blank" rel="external">CATCurveProgressView</a></p>
<h4 id="雷达图(咻一咻、波纹)">雷达图(咻一咻、波纹)</h4><p>效果：</p>
<p>实现步骤：</p>
<ol>
<li>利用CAShapeLayer创建脉冲层（就是一个圈圈）</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_pulseLayer = [CAShapeLayer layer];&#10;_pulseLayer.frame = self.layer.bounds;&#10;_pulseLayer.path = [UIBezierPath bezierPathWithOvalInRect:_pulseLayer.bounds].CGPath;&#10;_pulseLayer.fillColor = [UIColor blueColor].CGColor;</span><br></pre></td></tr></table></figure>
<ol>
<li>利用CAReplicatorLayer复制多个脉冲层</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_replicatorLayer = [CAReplicatorLayer layer];&#10;_replicatorLayer.frame = self.bounds;&#10;_replicatorLayer.instanceCount = 6;&#10;_replicatorLayer.instanceDelay = 1.5;&#10;[_replicatorLayer addSublayer:self.pulseLayer];</span><br></pre></td></tr></table></figure>
<ol>
<li>加上透明度与大小的动画</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CABasicAnimation *scaleAnima = [CABasicAnimation animationWithKeyPath:@&#34;transform&#34;];&#10;scaleAnima.fromValue = [NSValue valueWithCATransform3D:CATransform3DScale(CATransform3DIdentity, 0.0, 0.0, 0.0)];&#10;scaleAnima.toValue = [NSValue valueWithCATransform3D:CATransform3DScale(CATransform3DIdentity, 1.0, 1.0, 0.0)];&#10;&#10;_opacityAnima = [CABasicAnimation animationWithKeyPath:@&#34;opacity&#34;];&#10;_opacityAnima.fromValue = @(0.3);&#10;_opacityAnima.toValue = @(0.0);&#10;&#10;_animaGroup = [CAAnimationGroup animation];&#10;_animaGroup.animations = @[self.opacityAnima, scaleAnima];&#10;_animaGroup.duration = 9;&#10;_animaGroup.autoreverses = NO;&#10;_animaGroup.repeatCount = HUGE;&#10;&#10;[self.pulseLayer addAnimation:self.animaGroup forKey:@&#34;groupAnimation&#34;];</span><br></pre></td></tr></table></figure>
<p>具体工程参见：<a href="https://github.com/CatchZeng/CATRadarView" target="_blank" rel="external">CATRadarView</a></p>
<h2 id="iOS动画的实际应用">iOS动画的实际应用</h2><h4 id="XX公益，脉冲动画">XX公益，脉冲动画</h4><h4 id="XX芯，爱心动画">XX芯，爱心动画</h4>
                    
                        
                    
                    
                        <p>
                            <a href="/2015/12/30/ios_animation/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/12/22/ios_optimize/">
                            iOS性能优化基础到进阶
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-12-22T18:15:02+08:00">
	
		    Dec 22, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="iOS性能优化需要会什么？">iOS性能优化需要会什么？</h2><p>搞好iOS性能优化有时候是一件很难的事情，在开发过程中要时刻考虑到性能影响，不然开发出来的产品只会遭到用户的摒弃</p>
<h2 id="iOS性能优化是什么？">iOS性能优化是什么？</h2><p>建议将iOS的性能优化分为两个级别，慢慢补充：</p>
<h4 id="基础级">基础级</h4><ol>
<li>用ARC管理内存</li>
<li>在正确的地方使用reuseIdentifier</li>
<li>尽量把Views设置为完全不透明<ul>
<li><strong>apaque = YES</strong></li>
</ul>
</li>
<li>避免庞大的XIB</li>
<li>不要阻塞主线程<ul>
<li><strong>异步处理存储或网络</strong></li>
</ul>
</li>
<li>在Image Views中调整图片大小</li>
<li>选择正确的Collection<ul>
<li><strong>Array索引块；Dic键值查块；Set值查块，插入删除快</strong></li>
</ul>
</li>
<li>打开gzip压缩<ul>
<li><strong>服务端和app打开gzip</strong></li>
</ul>
</li>
<li>选择是否缓存图片<ul>
<li><strong>imageNamed imageWithContentsOfFile</strong></li>
</ul>
</li>
<li>尽量避免日期格式转换</li>
</ol>
<h4 id="进阶级">进阶级</h4><ol>
<li>重用和延迟加载Views<ul>
<li><strong>一次性创建和懒加载都要缺点：耗内存；第一次加载时稍显卡顿</strong> </li>
</ul>
</li>
<li>Cache, Cache, 还是Cache！</li>
<li>权衡渲染方法</li>
<li>处理内存警告<ul>
<li><strong>receiveMemoryWarning</strong></li>
</ul>
</li>
<li>重用大开销的对象<ul>
<li><strong>NSDateFormatter NSCalendar</strong></li>
</ul>
</li>
<li>使用Sprite Sheets</li>
<li>避免反复处理数据</li>
<li>选择正确的数据格式</li>
<li>正确地设定背景图片<ul>
<li><strong>colorWithPatternImage UIImageView</strong></li>
</ul>
</li>
<li>减少使用Web特性<ul>
<li><strong>避免过重的html5页面</strong></li>
</ul>
</li>
<li>设定Shadow Path<ul>
<li><strong>避免每次计算渲染路径</strong></li>
</ul>
</li>
<li>优化你的Table View </li>
<li>选择正确的数据存储选项</li>
<li>加速启动时间<ul>
<li><strong>尽可能做更多的异步任务，避免庞大的xib</strong></li>
</ul>
</li>
<li>使用Autorelease Pool</li>
</ol>
<h2 id="为什么做iOS性能优化？">为什么做iOS性能优化？</h2><p>随着代码累积，性能问题在所难免，苹果提供了各种Instruments工具帮助程序员定位一些常见的性能问题</p>
<h2 id="怎么做iOS性能优化？">怎么做iOS性能优化？</h2><h4 id="发现问题">发现问题</h4><ol>
<li>用户反馈（包括测试人员）</li>
<li>在线监控：<ul>
<li>业务性能监控，主要测试关键的操作路径，比如业务时间线：启动、打开档期、打开详情、加入购物车、下单、支付等</li>
<li>卡顿监控：Bugly工具跟踪</li>
</ul>
</li>
</ol>
<h4 id="解决问题">解决问题</h4><p>主要做到几点核心：</p>
<ol>
<li>优化业务流程<ul>
<li>在满足业务需求的同时，提出更高效优雅的解决方案</li>
</ul>
</li>
<li>合理的线程分配（尽量避免多线程）<ul>
<li>UI和DataSource操作一定在主线程</li>
<li>DB操作、日志记录、网络回调都在各自的固定线程</li>
<li>不同业务，通过创建队列保证数据一致性</li>
</ul>
</li>
<li>预处理和延时加载<ul>
<li>预处理：耗费大量线程时间的操作放到后台线程进行计算</li>
<li>延时加载：先加载当前必须得可视内容，在稍后时间或事件时再触发加载其它内容</li>
<li>总结：这两种方法都是针对自然比较紧张的情况，比如微信读书中阅读的排版优先级是最高的，在阅读过程中会预处理下一页、下一章的排版，同时延时加载阅读相关的其它数据（加想法、划线、书签等）</li>
</ul>
</li>
<li>缓存<ul>
<li>并发访问cache，数据一致性问题</li>
<li>cache线程安全，防止一边修改一边遍历的crash</li>
<li>cache查找时性能问题</li>
<li>cache的释放和重建，避免占用空间无限扩大</li>
</ul>
</li>
<li>使用正确的API<ul>
<li>选择合适的容器</li>
<li>imageNamed  imageWithContentsFile</li>
<li>NSDateFormatter</li>
<li>不要随意使用NSLog()</li>
</ul>
</li>
</ol>
<h4 id="预防问题">预防问题</h4><p>使用小工具尽早的在开发阶段暴露问题：</p>
<ul>
<li>内存泄露检测工具  <a href="https://github.com/Zepo/MLeaksFinder" target="_blank" rel="external">MLeaksFinder</a></li>
<li>FPS/SQL性能监测工具条</li>
<li>UI/DataSource主线程检测工具</li>
<li>排版引擎自动化监测工具</li>
<li>数据源检测工具 </li>
</ul>
<h2 id="iOS性能优化的实际应用">iOS性能优化的实际应用</h2><h4 id="XX会公益SDK">XX会公益SDK</h4><ol>
<li>内存泄露检测工具</li>
<li>Instruments</li>
<li>动画绘制</li>
<li>合并网络请求并开启gzip</li>
<li>批量日志上报</li>
<li>本地缓存设计<br><img src="https://www.processon.com/chart_image/58577e2be4b0c1fa6c5ab71f.png" alt=""></li>
</ol>
<h4 id="XX会档期列表">XX会档期列表</h4><ol>
<li>ReactNative listView性能问题</li>
<li>图片资源延时加载</li>
</ol>
<h4 id="微信读书">微信读书</h4><p>微信工程师分享过微信读书的分享可以参看：<a href="http://dev.qq.com/topic/578c93ca9644bd524bfcabe8" target="_blank" rel="external">微信读书 iOS 性能优化</a></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2015/12/22/ios_optimize/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/11/30/ios_live/">
                            iOS直播基础到进阶
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-11-30T18:15:02+08:00">
	
		    Nov 30, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="学习iOS直播需要会什么？">学习iOS直播需要会什么？</h2><p>直播很火，直播中的基础功能：</p>
<ol>
<li>推流（支持业界标准、软编及硬编）</li>
<li>播放（直播支持FLV/RTMP、点播支持FLV/HLS/MP4）</li>
<li>互动消息(海量文本、弹幕、点赞、送礼等)</li>
<li>动效表情(人脸识别、人脸跟踪、特效表情渲染)</li>
<li>混音伴奏（麦克风+伴奏）</li>
<li>智能选路（选择最优推流服务器）</li>
<li>延迟修正（帧维度的声画同步校准）</li>
<li>带宽自适应（流畅度、清晰度、延迟三维度平衡）</li>
<li>运营监控（视频监控、禁播、数据分析）</li>
<li>手机录屏</li>
</ol>
<p>除此之外可能还有：</p>
<ol>
<li>实时录制</li>
<li>实时水印</li>
<li>实时截图</li>
<li>实时转码</li>
<li>实时鉴黄</li>
<li>连麦互动</li>
<li>秒级禁播</li>
<li>延时直播</li>
<li>美颜滤镜</li>
</ol>
<h2 id="iOS直播是什么？">iOS直播是什么？</h2><h4 id="工作流">工作流</h4><p><img src="https://www.processon.com/chart_image/585a3d3ee4b03a03b17fe2b1.png" alt=""></p>
<h4 id="核心知识点">核心知识点</h4><p><img src="http://ww2.sinaimg.cn/large/006tNc79gw1faypg480rlj31kw0ogjyo.jpg" alt=""></p>
<h2 id="为什么要用iOS直播?">为什么要用iOS直播?</h2><p>音视频技术处理有很多API，具体的功能点的实现可以参见：<a href="http://www.jianshu.com/p/d99e83cab39a?utm_campaign=hugo&amp;utm_medium=reader_share&amp;utm_content=note" target="_blank" rel="external">研发直播APP的收获-iOS</a></p>
<ol>
<li><a href="http://www.jianshu.com/p/bb9c41496f8e" target="_blank" rel="external">直播APP的性能优化-礼物篇</a></li>
<li><a href="http://www.jianshu.com/p/37784e363b8a" target="_blank" rel="external">使用VideoToolbox硬编码H.264</a></li>
<li><a href="http://www.jianshu.com/p/da18b979aeec" target="_blank" rel="external">使用VideoToolbox硬解码H.264</a></li>
<li><a href="http://www.jianshu.com/p/a671f5b17fc1" target="_blank" rel="external">使用AudioToolbox编码AAC</a></li>
<li><a href="http://www.jianshu.com/p/279a9e5b36b5" target="_blank" rel="external">使用AudioToolbox播放AAC</a></li>
<li><a href="http://www.jianshu.com/p/39a1a8e78675" target="_blank" rel="external">使用AudioToolbox播放AAC</a></li>
<li><a href="http://www.jianshu.com/p/ba5045da282c" target="_blank" rel="external">HLS推流的实现（iOS和OS X系统）</a></li>
</ol>
<h2 id="iOS直播怎么用？">iOS直播怎么用？</h2><h4 id="腾讯云_RTMPSDK_工作流">腾讯云 RTMPSDK 工作流</h4><p><img src="https://www.processon.com/chart_image/585a3188e4b03a03b17e1b95.png" alt=""></p>
<h4 id="腾讯云_IMSDK">腾讯云 IMSDK</h4><h2 id="iOS直播的实际应用">iOS直播的实际应用</h2><h4 id="XX会_直播">XX会 直播</h4><ol>
<li>边看边买，推荐直播中使用的商品<ul>
<li>CAAnimationGroup showInView</li>
</ul>
</li>
<li>点赞动画，累积到一定数量push商品详情<ul>
<li>点赞数累积到20次以上上传</li>
<li>桃心动画: CAShapeLayer  CAAnimationGroup </li>
</ul>
</li>
<li>弹幕<ul>
<li>自己的IM实现</li>
</ul>
</li>
<li>视频渲染层 <ul>
<li>TXLivePlayer   </li>
<li>可以研究下ijkplayer</li>
</ul>
</li>
</ol>
<h4 id="XX蜂_直播">XX蜂 直播</h4><h6 id="海量弹幕的处理？">海量弹幕的处理？</h6><p>不能说用户发一次弹幕就上传一次，这样特别耗费CPU和流量，应该提供本地累积存储机制，比如在累积过100条后再触发上传</p>
<h6 id="礼物的定时器？">礼物的定时器？</h6><p>可以使用CADisplayLink和NSTimer，一般mode选择NSRunLoopCommonModes</p>
<h6 id="序列帧">序列帧</h6><p>加载很多次图片时，可以把所有图片放在一张图上，使用CGImageCreateWithImageInRect切割</p>
<h6 id="内存优化">内存优化</h6><ol>
<li>注意送豪华礼物时，内存会猛增20M左右，因为图片和动画效果</li>
<li>图片本很小，加到内存猛增，查看imageName:（会缓存，但是使用完不释放） 和 imageWithContentsOfFile:（不缓存，使用完会回收）的使用是否恰当</li>
<li>聊天UITableView性能消耗<ul>
<li>cell高度计算，图片加载，layout优化</li>
<li>缓存cell高度</li>
<li>图片加载用cache实现</li>
<li>尽量避免autolayout</li>
<li>控制每帧刷新数量</li>
<li>删除过多的历史消息</li>
</ul>
</li>
</ol>

                    
                        
                    
                    
                        <p>
                            <a href="/2015/11/30/ios_live/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/09/22/mvvm_profile/">
                            从Web看Native的MVVM
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-09-22T23:14:02+08:00">
	
		    Sep 22, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="背景">背景</h2><blockquote>
<p>  随着前端技术的在开发工作中的角色越来越重要，需求量也越来越大，那么高效率的框架也应运而生，过去script方式已进化为MVC，现在我们是否应该顺应潮流推动MVC进化到MVVM呢？（MVP）</p>
</blockquote>
<h2 id="介绍">介绍</h2><ol>
<li>web与native的组成对比<ul>
<li>web : html + css + js</li>
<li>android : 四大组件(activity、service、broadcase receiver、content provider)和五大布局(LinearLayout、FrameLayout、RelativeLayout、AbsoluteLayout、TableLayout) 还有 java (data binding library)</li>
<li>iOS : xib/storyboard + oc/swift   </li>
<li>react(react.js、react canvas、react native)  </li>
</ul>
</li>
<li>web前端常用的MVVM主流框架<ul>
<li>handlebars.js、knockout.js、ember.js、avalon.js、angular.js </li>
<li>backbone.js?, react.js?</li>
</ul>
</li>
<li>angularJS的核心功能<ul>
<li>自动化双向数据绑定、模块化/组件化、依赖注入、语义化标签等</li>
</ul>
</li>
<li>angularJS的原理<ul>
<li>首先，浏览器会一直处于监听状态，一旦有事件被触发，就会被加到一个event queue中，event queue中的事件会一个一个的执行。</li>
<li>event queue中的事件如果是被$apply()包起来的话，就会进入到AngularJS的context中，假设的fn()是我们希望在AngularJS的context中执行的函数。</li>
<li>AngularJS将执行fn()函数，通常情况下，这个函数会改变应用的某些状态。</li>
<li>然后AngularJS会进入到由两个小循环组成的digest循环中，一个循环是用来处理evalAsync队列（用来schedule一些需要在渲染视图之前处理的操作，通常通过setTimeout(0)实现，速度会比较慢，可能会出现视图抖动的问题）的，一个循环是处理watch列表（是一些表达式的集合，一旦有改变发生，那么watch函数就会被调用）的。digest循环会一直迭代知道evalAsync队列为空并且$watch列表也为空的时候，即model不再有任何变化。</li>
<li>一旦AngularJS的$digest循环结束，整个执行就会离开AngularJS和Javascript的context，紧接着浏览器就会把数据改变后的视图重新渲染出来。</li>
</ul>
</li>
<li>iOS常用的MVVM框架<ul>
<li>KVO  reactiveCocoa</li>
</ul>
</li>
<li>reactiveCocoa的核心功能<ul>
<li>自动化双向数据绑定、模块化/组件化(?)、依赖注入(无)、语义化标签(?)等</li>
<li>像KVO,但它用blocks代替了重写-observeValueForKeyPath:ofObject:change:context:</li>
<li>提供了一个单一的，统一的方法去处理异步的行为,包括delegate方法,blocks回调,target-action机制,notifications和KVO.</li>
</ul>
</li>
<li>reactiveCocoa的原理<ul>
<li>RACSignal发送事件流给它的subscriber。目前总共有三种类型的事件：next、error、completed。</li>
<li>RACSignal有很多方法可以来订阅不同的事件类型。每个方法都需要至少一个block，当事件发生时就会执行block中的逻辑。</li>
<li>使用category来为很多基本UIKit控件添加signal。这样你就能给控件添加订阅了，text field的rac_textSignal就是这么来的。</li>
</ul>
</li>
<li>angularJS与reactiveCocoa的对比<ul>
<li>核心功能对比</li>
<li>实现原理对比</li>
<li>实际运用对比</li>
</ul>
</li>
</ol>
<h2 id="总结">总结</h2><blockquote>
<p>MVVM是未来</p>
</blockquote>

                    
                        
                    
                    
                        <p>
                            <a href="/2015/09/22/mvvm_profile/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/06/17/c3p0/">
                            C3P0的两种用法
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-06-17T18:15:02+08:00">
	
		    Jun 17, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h6 id="background">background</h6><blockquote>
<p>这篇文章摘抄自我的新浪博客，<a href="http://blog.sina.com.cn/s/blog_6c5f4d3c01012gtq.html" target="_blank" rel="external">详情链接</a> 因为它一度为我的新浪博客积累超过7万的人气，新浪博客已经远不如曾经，所以我想把这篇文章保留下来，以下是原文</p>
</blockquote>
<h6 id="方法一：">方法一：</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package   C3P0; </span><br><span class="line">import   java.sql.Connection; </span><br><span class="line">import   java.sql.SQLException; </span><br><span class="line">import   java.beans.PropertyVetoException; </span><br><span class="line">import   com.mchange.v2.c3p0.ComboPooledDataSource; </span><br><span class="line">public   class   DBPool&#123;       </span><br><span class="line">   private   static   DBPool   dbPool;       </span><br><span class="line">   private   ComboPooledDataSource   dataSource;     </span><br><span class="line">	</span><br><span class="line">   static   &#123;       </span><br><span class="line">           dbPool=new   DBPool();       </span><br><span class="line">   &#125;       </span><br><span class="line">   </span><br><span class="line">   public   DBPool()&#123;       </span><br><span class="line">           try   &#123;       </span><br><span class="line">                   dataSource=new   ComboPooledDataSource();       </span><br><span class="line">                   dataSource.setUser( "id ");       </span><br><span class="line">                   dataSource.setPassword( "pw ");       </span><br><span class="line">                   dataSource.setJdbcUrl( "jdbc:mysql://127.0.0.1:3306/test? </span><br><span class="line">	</span><br><span class="line">autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=GB2312 "); </span><br><span class="line">                   dataSource.setDriverClass( "com.mysql.jdbc.Driver "); </span><br><span class="line">                   dataSource.setInitialPoolSize(2); </span><br><span class="line">                   dataSource.setMinPoolSize(1); </span><br><span class="line">                   dataSource.setMaxPoolSize(10); </span><br><span class="line">                   dataSource.setMaxStatements(50); </span><br><span class="line">                   dataSource.setMaxIdleTime(60);       </span><br><span class="line">           &#125;   catch   (PropertyVetoException   e)   &#123;       </span><br><span class="line">               throw   new   RuntimeException(e);       </span><br><span class="line">           &#125;       </span><br><span class="line">   &#125;       </span><br><span class="line">	</span><br><span class="line">   public   final   static   DBPool   getInstance()&#123;       </span><br><span class="line">           return   dbPool;       </span><br><span class="line">   &#125;       </span><br><span class="line">	</span><br><span class="line">   public   final   Connection   getConnection()   &#123;       </span><br><span class="line">           try   &#123;       </span><br><span class="line">                   return   dataSource.getConnection();       </span><br><span class="line">           &#125;   catch   (SQLException   e)   &#123;       </span><br><span class="line">                   throw   new   RuntimeException( "无法从数据源获取连接 ",e);       </span><br><span class="line">           &#125;       </span><br><span class="line">   &#125;     </span><br><span class="line">   </span><br><span class="line">   public   static   void   main(String[]   args)   throws   SQLException   &#123; </span><br><span class="line">Connection   con   =   null; </span><br><span class="line">try   &#123; </span><br><span class="line">con   =   DBPool.getInstance().getConnection(); </span><br><span class="line">&#125;   catch   (Exception   e)&#123; </span><br><span class="line">&#125;   finally   &#123; </span><br><span class="line">if   (con   !=   null) </span><br><span class="line">con.close(); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="方法二：">方法二：</h6><pre><code>原来不知道使用c3p0 是如此的简单，我一直使用<span class="keyword">properties</span> 文件去配置c3p0，但总是连接不上数据库，后来调试才发现ComboPooledDataSource 这个对象的属性没有被设置成功，我是先获取了<span class="keyword">properties</span>文件的内容，封装在一个 Properties对象里面，然后直接调用 ComboPooledDataSource 的 setProperties（Properties  p） 方法来配置c3p0，程序是没有报错，但连不上数据库，调试发现属性都没有设置成功，只是<span class="keyword">properties</span>这个属性被设置了而已，结果我对每个属性调用set方法后就连接上了。。。
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionManager</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> ConnectionManager instance;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> ComboPooledDataSource ds;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> String c3p0Properties = <span class="string">"c3p0.properties"</span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="title">ConnectionManager</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Properties p = <span class="keyword">new</span> Properties();</span><br><span class="line">  p.load(<span class="keyword">this</span>.getClass().getResourceAsStream(c3p0Properties));</span><br><span class="line">  ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">  ds.setUser(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setPassword(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setJdbcUrl(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setDriverClass(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setInitialPoolSize(Integer.parseInt(p.getProperty(<span class="string">"initialPoolSize"</span>)));</span><br><span class="line">  ds.setMinPoolSize(Integer.parseInt(p.getProperty(<span class="string">"minPoolSize"</span>)));</span><br><span class="line">  ds.setMaxPoolSize(Integer.parseInt(p.getProperty(<span class="string">"maxPoolSize"</span>)));</span><br><span class="line">  ds.setMaxStatements(Integer.parseInt(p.getProperty(<span class="string">"maxStatements"</span>)));</span><br><span class="line">  ds.setMaxIdleTime(Integer.parseInt(p.getProperty(<span class="string">"maxIdleTime"</span>)));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ConnectionManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">    instance = <span class="keyword">new</span> ConnectionManager();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">final</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">  DataSources.destroy(ds); <span class="comment">// 关闭datasource</span></span><br><span class="line">  <span class="keyword">super</span>.finalize();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>如此就可以获取connection来做jdbc操作了：
Connection         
conn=ConnectionManager.getInstance().getConnection()<span class="comment">;</span>
记得使用完后调用close方法：
conn.close()<span class="comment">;</span>
c3p0 的某些参数的配置以及意义见另外一篇文章http://kangzye.blog.163.com/blog/static/<span class="number">3681922320104</span><span class="number">42162576</span>/
</code></pre>
                    
                        
                    
                    
                        <p>
                            <a href="/2015/06/17/c3p0/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/05/17/easy_compiler/">
                            一个简单的编译器
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-05-17T18:15:02+08:00">
	
		    May 17, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <pre><code>简单的说 编译器 就是语言翻译器，它一般将高级语言翻译成更低级的语言，如 GCC 可将 <span class="keyword">C</span>/<span class="keyword">C</span>++ 语言翻译成可执行机器语言，Java 编译器可以将 Java 源代码翻译成 Java 虚拟机可以执行的字节码。

编译器如此神奇，那么它到底是如何工作的呢？本文将简单介绍编译器的原理，并实现一个简单的编译器，使它能编译我们自定义语法格式的源代码。（文中使用的源码都已上传至 GitHub 以方便查看）。
</code></pre><h6 id="自定义语法">自定义语法</h6><pre><code>为了简洁易懂，我们的编译器将只支持以下简单功能：
</code></pre><ul>
<li>数据类型只支持整型，这样不需要数据类型符；</li>
<li>支持 加（+），减（-），乘（*）， 除（/） 运算</li>
<li>支持函数调用</li>
<li>支持 extern（为了调用 printf 打印计算结果）</li>
</ul>
<p>以下是我们要支持的源码实例 demo.xy：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="title">printi</span><span class="params">(val)</span></span><br><span class="line"></span><br><span class="line"><span class="title">sum</span><span class="params">(a, b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mult(a, b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printi(mult(<span class="number">4</span>, <span class="number">5</span>) - sum(<span class="number">4</span>, <span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<h6 id="编译原理简介">编译原理简介</h6><pre><code>一般编译器有以下工作步骤：
</code></pre><ul>
<li>词法分析（Lexical analysis）： 此阶段的任务是从左到右一个字符一个字符地读入源程序，对构成源程序的字符流进行扫描然后根据构词规则识别 单词（Token），完成这个任务的组件是 词法分析器（Lexical analyzer，简称Lexer），也叫 扫描器（Scanner）；</li>
<li>语法分析（Syntactic analysis，也叫 Parsing）： 此阶段的主要任务是由 词法分析器 生成的单词构建 抽象语法树（Abstract Syntax Tree ，AST），完成此任务的组件是 语法分析器（Parser）；</li>
<li>目标码生成： 此阶段编译器会遍历上一步生成的抽象语法树，然后为每个节点生成 机器 / 字节码。<br>编译器完成编译后，由 链接器（Linker） 将生成的目标文件链接成可执行文件，这一步并不是必须的，一些依赖于虚拟机运行的语言（如 Java，Erlang）就不需要链接。</li>
</ul>
<h6 id="工具简介">工具简介</h6><pre><code>对应编译器工作步骤我们将使用以下工具，括号里标明了所使用的版本号：
</code></pre><ul>
<li>Flex（2.6.0）: Flex 是 Lex 开源替代品，他们都是 词法分析器 制作工具，它可以根据我们定义的规则生成 词法分析器 的代码；</li>
<li>Bison（3.0.4）： Bison 是 语法分析器 的制作工具，同样它可以根据我们定义的规则生成 语法分析器 的代码；</li>
<li><p>LLVM（3.8.0）： LLVM 是构架编译器的框架系统，我们会利用他来完成从 抽象语法树 生成目标码的过程。</p>
<p>  在 ubuntu 上可以通过以下命令安装这些工具：</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install flex</span><br><span class="line">sudo apt-get install bison</span><br><span class="line">sudo apt-get install llvm-<span class="number">3.8</span>*</span><br></pre></td></tr></table></figure>
<pre><code>介绍完工具，现在我们可以开始实现我们的编译器了。
</code></pre><h6 id="词法分析器">词法分析器</h6><pre><code>前面提到 词法分析器 要将源程序分解成 单词，我们的语法格式很简单，只包括：标识符，数字，数学运算符，括号和大括号等，我们将通过 <span class="attribute">Flex</span> 来生成 词法分析器 的源码，给 <span class="attribute">Flex</span> 使用的规则文件 lexical<span class="class">.l</span> 如下：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"ast.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"syntactic.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SAVE_TOKEN  yylval.string = new std::string(yytext, yyleng)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> TOKEN(t)    (yylval.token = t)</span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%option noyywrap</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">[ \t\n]                 ;</span><br><span class="line"><span class="string">"extern"</span>                <span class="keyword">return</span> TOKEN(TEXTERN);</span><br><span class="line"><span class="string">"return"</span>                <span class="keyword">return</span> TOKEN(TRETURN);</span><br><span class="line">[a-zA-Z_][a-zA-Z0-<span class="number">9</span>_]*  SAVE_TOKEN; <span class="keyword">return</span> TIDENTIFIER;</span><br><span class="line">[<span class="number">0</span>-<span class="number">9</span>]+                  SAVE_TOKEN; <span class="keyword">return</span> TINTEGER;</span><br><span class="line"></span><br><span class="line"><span class="string">"="</span>                     <span class="keyword">return</span> TOKEN(TEQUAL);</span><br><span class="line"><span class="string">"=="</span>                    <span class="keyword">return</span> TOKEN(TCEQ);</span><br><span class="line"><span class="string">"!="</span>                    <span class="keyword">return</span> TOKEN(TCNE);</span><br><span class="line"><span class="string">"("</span>                     <span class="keyword">return</span> TOKEN(TLPAREN);</span><br><span class="line"><span class="string">")"</span>                     <span class="keyword">return</span> TOKEN(TRPAREN);</span><br><span class="line"><span class="string">"&#123;"</span>                     <span class="keyword">return</span> TOKEN(TLBRACE);</span><br><span class="line"><span class="string">"&#125;"</span>                     <span class="keyword">return</span> TOKEN(TRBRACE);</span><br><span class="line"><span class="string">","</span>                     <span class="keyword">return</span> TOKEN(TCOMMA);</span><br><span class="line"><span class="string">"+"</span>                     <span class="keyword">return</span> TOKEN(TPLUS);</span><br><span class="line"><span class="string">"-"</span>                     <span class="keyword">return</span> TOKEN(TMINUS);</span><br><span class="line"><span class="string">"*"</span>                     <span class="keyword">return</span> TOKEN(TMUL);</span><br><span class="line"><span class="string">"/"</span>                     <span class="keyword">return</span> TOKEN(TDIV);</span><br><span class="line"></span><br><span class="line">.                       <span class="built_in">printf</span>(<span class="string">"Unknown token!\n"</span>); yyterminate();</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<pre><code>我们来解释一下，这个文件被 <span class="number">2</span> 个 %% 分成 <span class="number">3</span> 部分，第 <span class="number">1</span> 部分用 %{ 与 %} 包括的是一些 C++ 代码，会被原样复制到 Flex 生成的源码文件中，还可以在指定一些选项，如我们使用了 %option noyywrap，也可以在这定义宏供后面使用；第 <span class="number">2</span> 部分用来定义构成单词的规则，可以看到每条规都是一个 正则表达式 和 动作，很直白，就是 词法分析器 发现了匹配的 单词 后执行相应的 动作 代码，大部分只要返回 单词 给调用者就可以了；第 <span class="number">3</span> 部分可以定义一些函数，也会原样复制到生成的源码中去，这里我们留空没有使用。

现在我们可以通过调用 Flex 生成 词法分析器 的源码：

flex -o lexical.cpp lexical.l

生成的　lexical.cpp　里会有一个 yylex() 函数供　语法分析器　调用；你可能发现了，有些宏和变量并没有被定义（如TEXTERN，yylval，yytext 等），其实有些是 Flex 会自动定义的内置变量（如 yytext），有些是后面 语法分析器 生成工具里定义的变量（如 yylval），我们后面会看到。
</code></pre><h6 id="语法分析器">语法分析器</h6><pre><code>语法分析器 的作用是构建 抽象语法树，通俗的说 抽象语法树 就是将源码用树状结构来表示，每个节点都代表源码中的一种结构；对于我们要实现的语法，其语法树是很简单的，如下：



现在我们使用 <span class="keyword">Bison </span>生成 语法分析器 代码，同样 <span class="keyword">Bison </span>需要一个规则文件，我们的规则文件 syntactic.y 如下，限于篇幅，省略了某些部分，可以通过链接查看完整内容：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">    <span class="preprocessor">#<span class="keyword">include</span> <span class="string">"ast.h"</span></span></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">yylex</span><span class="params">()</span></span>;    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">yyerror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">printf</span>(<span class="string">"Error: %s\n"</span>, s);<span class="built_in">std</span>::<span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">%token &lt;token&gt; TLPAREN TRPAREN TLBRACE TRBRACE TCOMMA</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">program:</span><br><span class="line">  stmts &#123; programBlock = $<span class="number">1</span>; &#125;</span><br><span class="line">        ;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">func_decl:</span><br><span class="line">  ident TLPAREN func_decl_args TRPAREN block &#123; $$ = <span class="keyword">new</span> NFunctionDeclaration(*$<span class="number">1</span>, *$<span class="number">3</span>, *$<span class="number">5</span>); <span class="keyword">delete</span> $<span class="number">3</span>; &#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<pre><code>是不是发现和 <span class="attribute">Flex</span> 的规则文件很像呢？确实是这样，它也是分 3 个部分组成，同样，第一部分的 C++ 代码会被复制到生成的源文件中，还可以看到这里通过以下这样的语法定义前面了 <span class="attribute">Flex</span> 使用的宏：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%token &lt;token&gt; TLPAREN TRPAREN TLBRACE TRBRACE TCOMMA</span><br></pre></td></tr></table></figure>
<pre><code>比较不同的是第 <span class="number">2</span> 部分，不像 Flex 通过 正则表达式 通过定义规则，这里使用的是 巴科斯范式（<span class="keyword">BNF: </span><span class="keyword">Backus-Naur </span>Form） 的形式定义了我们识别的语法结构。如下的语法表示函数：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func_decl:</span><br><span class="line">  ident TLPAREN func_decl_args TRPAREN block &#123; $$ = <span class="keyword">new</span> NFunctionDeclaration(*$<span class="number">1</span>, *$<span class="number">3</span>, *$<span class="number">5</span>); <span class="keyword">delete</span> $<span class="number">3</span>; &#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<pre><code>可以看到后面大括号中间的也是 动作 代码，上例的动作是在 抽象语法树 中生成一个函数的节点，其实这部分的其他规则也是生成相应类型的节点到语法树中。像 NFunctionDeclaration 这是一个我们自己定义的节点类，我们在 ast<span class="class">.h</span> 中定义了我们所要用到的节点，同样的，我们摘取一段代码如下：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">class</span> NFunctionDeclaration : <span class="keyword">public</span> NStatement &#123;</span><br><span class="line"><span class="keyword">public</span>:    </span><br><span class="line">    <span class="keyword">const</span> NIdentifier&amp; id;</span><br><span class="line">    VariableList arguments;</span><br><span class="line">    NBlock&amp; block;</span><br><span class="line">    NFunctionDeclaration(<span class="keyword">const</span> NIdentifier&amp; id,            </span><br><span class="line">            <span class="keyword">const</span> VariableList&amp; arguments, NBlock&amp; block) :</span><br><span class="line">        id(id), arguments(arguments), block(block) &#123; &#125;    </span><br><span class="line">    <span class="keyword">virtual</span> llvm::<span class="function">Value* <span class="title">codeGen</span><span class="params">(CodeGenContext&amp; context)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<pre><code>可以看到，它有 标识符（id），参数列表（arguments），函数体（block） 这些成员，在语法分析阶段会设置好这些成员的内容供后面的 目标码生成 阶段使用。还可以看到有一个 <span class="function"><span class="title">codeGen</span><span class="params">()</span></span> 虚函数，你可能猜到了，后面就是通过调用它来生成相应的目标代码。

我们可以通过以下命令调用 Bison 生成 语法分析器 的源码文件，这里我们使用 -d 使头文件和源文件分开，因为前面 词法分析器 的源码使用了这里定义的一些宏，所以需要使用这个头文件，这里将会生成 syntactic<span class="class">.cpp</span> 和 syntactic.hpp：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bison -d -o syntactic.cpp syntactic.y</span><br></pre></td></tr></table></figure>
<h6 id="目标码生成">目标码生成</h6><pre><code>这是最后一步了，这一步的主角是前面提到 LLVM，LLVM 是一个构建编译器的框架系统，我们使用他遍历 语法分析 阶段生成的 抽象语法树，然后为每个节点生成相应的 目标码。当然，无法避免的是我们需要使用 LLVM 提供的函数来编写生成目标码的源码，就是实现前面提到的虚函数 <span class="function"><span class="title">codeGen</span><span class="params">()</span></span>，是不是有点拗口？不过确实是这样。我们在 gen<span class="class">.cpp</span> 中编写了不同节点的生成代码，我们摘取一段看一下：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">Value *NMethodCall::codeGen(CodeGenContext &amp;context) &#123;</span><br><span class="line">    Function *function = context.module-&gt;getFunction(id.name.c_str());    <span class="keyword">if</span> (function == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"no such function "</span> &lt;&lt; id.name &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Value *&gt; args;</span><br><span class="line">    ExpressionList::const_iterator it;    </span><br><span class="line">    <span class="keyword">for</span> (it = arguments.begin(); it != arguments.end(); it++) &#123;</span><br><span class="line">        args.push_back((**it).codeGen(context));</span><br><span class="line">    &#125;</span><br><span class="line">    CallInst *call = CallInst::Create(function, makeArrayRef(args), <span class="string">""</span>, context.currentBlock());</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Creating method call: "</span> &lt;&lt; id.name &lt;&lt; endl;   </span><br><span class="line">    <span class="keyword">return</span> call;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<pre><code>看起来有点复杂，简单来说就是通过 LLVM 提供的接口来生成 目标码，需要了解更多的话可以去 LLVM 的官网学习一下。

至此，我们所有的工作基本都做完了。简单回顾一下：我们先通过 Flex 生成 词法分析器 源码文件 lexical.cpp，然后通过 Bison 生成 语法分析器 源码文件 syntactic<span class="class">.cpp</span> 和头文件 syntactic.hpp，我们自己编写了 抽象语法树 节点定义文件 ast<span class="class">.h</span> 和 目标码 生成文件 ast.cpp，还有一个 gen<span class="class">.h</span> 包含一点 LLVM 环境相关的代码，为了输出我们程序的结果，还在 printi<span class="class">.cpp</span> 里简单的通过调用 C 语言库函数实现了输出一个整数。

对了，我们还需要一个 main 函数作为编译器的入口函数，它在 main<span class="class">.cpp</span> 里：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    yyparse();</span><br><span class="line">    InitializeNativeTarget();</span><br><span class="line">    InitializeNativeTargetAsmPrinter();</span><br><span class="line">    InitializeNativeTargetAsmParser();</span><br><span class="line">    CodeGenContext context;</span><br><span class="line">    context.generateCode(*programBlock);</span><br><span class="line">    context.runCode();    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>我们可以看到其调用了 <span class="function"><span class="title">yyparse</span><span class="params">()</span></span> 做 语法分析，（<span class="function"><span class="title">yyparse</span><span class="params">()</span></span> 内部会先调用 <span class="function"><span class="title">yylex</span><span class="params">()</span></span> 做 词法分析）；然后是一系列的 LLVM 初始化代码，context.<span class="function"><span class="title">generateCode</span><span class="params">(*programBlock)</span></span> 是开始生成 目标码；最后是 context.<span class="function"><span class="title">runCode</span><span class="params">()</span></span> 来运行代码，这里使用了 LLVM 的 JIT（Just In Time） 来直接运行代码，没有链接的过程。

现在我们可以用这些文件生成我们的编译器了，需要说明一下，因为 词法分析器 的源码使用了一些 语法分析器 头文件中的宏，所以正确的生成顺序是这样的：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bison -d -o syntactic.cpp syntactic.y</span><br><span class="line">flex -o lexical.cpp lexical.l syntactic.hpp</span><br><span class="line">g++ -c `llvm-config --cppflags` -<span class="built_in">std</span>=c++<span class="number">11</span> syntactic.cpp gen.cpp lexical.cpp printi.cpp main.cpp</span><br><span class="line">g++ -o xy-complier syntactic.o gen.o main.o lexical.o printi.o `llvm-config --libs` `llvm-config --ldflags` -lpthread -ldl -lz -lncurses -rdynamic</span><br></pre></td></tr></table></figure>
<pre><code>如果你下载了 GitHub 的源码，那么直接：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd src</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<pre><code>就可以完成以上过程了，正常会生成一个二进制文件 xy-complier，它就是我们的编译器了。
</code></pre><h6 id="编译测试">编译测试</h6><pre><code>我们使用之前提到实例 demo<span class="class">.xy</span> 来测试，将其内容传给 xy-complier 的标准输入就可以看到运行结果了：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat demo.xy | ./xy-complier</span><br></pre></td></tr></table></figure>
<pre><code>也可以直接通过

make <span class="built_in">test</span>
来测试，输出如下：
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">define internal i64 @mult(i64 %a1, i64 %b2) &#123;</span><br><span class="line">entry:</span><br><span class="line">  %a = alloca i64</span><br><span class="line">  %<span class="number">0</span> = load i64, i64* %a</span><br><span class="line">  store i64 %a1, i64* %a</span><br><span class="line">  %b = alloca i64</span><br><span class="line">  %<span class="number">1</span> = load i64, i64* %b</span><br><span class="line">  store i64 %b2, i64* %b</span><br><span class="line">  %<span class="number">2</span> = load i64, i64* %b</span><br><span class="line">  %<span class="number">3</span> = load i64, i64* %a</span><br><span class="line">  %<span class="number">4</span> = mul i64 %<span class="number">3</span>, %<span class="number">2</span></span><br><span class="line">  ret i64 %<span class="number">4</span>&#125;</span><br><span class="line">Running code:<span class="number">11</span>Exiting...</span><br></pre></td></tr></table></figure>
<pre><code>可以看到最后正确输出了期望的结果，至此我们简单的编译器就完成了。
</code></pre>
                    
                        
                    
                    
                        <p>
                            <a href="/2014/05/17/easy_compiler/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        <li class="pagination-prev">
            
                <a class="btn btn--default btn--small" href="/archives/page/2/">
            
                <i class="fa fa-angle-left text-base icon-mr"></i>
                    <span>NEWER POSTS</span>
            </a>
        </li>
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/page/4/">
                    <span>OLDER POSTS</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">page 3 of 4</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 yolynn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/head.png"/>
        
            <h4 id="about-card-name">yolynn</h4>
        
            <h5 id="about-card-bio"><p>云在青天水在瓶 - 幽灵鸟</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>vip.com</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                China
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/jquery.js" type="text/javascript"></script>
<script src="/assets/js/jquery.fancybox.js" type="text/javascript"></script>
<script src="/assets/js/jquery.fancybox-thumbs.js" type="text/javascript"></script>
<script src="/assets/js/tranquilpeak.js" type="text/javascript"></script>
<!--SCRIPTS END-->



</html>
