
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="yolynn">
    <title>Archives: 2015 - yolynn</title>
    <meta name="author" content="yolynn">
    
    
        <link rel="icon" href="http://yolynn.com/assets/images/head.png">
    
    
    <meta name="description" content="äº‘åœ¨é’å¤©æ°´åœ¨ç“¶">
<meta property="og:type" content="blog">
<meta property="og:title" content="yolynn">
<meta property="og:url" content="http://yolynn.com/archives/2015/page/2/index.html">
<meta property="og:site_name" content="yolynn">
<meta property="og:description" content="äº‘åœ¨é’å¤©æ°´åœ¨ç“¶">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yolynn">
<meta name="twitter:description" content="äº‘åœ¨é’å¤©æ°´åœ¨ç“¶">
    
    
        
    
    
        <meta property="og:image" content="http://yolynn.com/assets/images/head.png"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox-thumbs.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css" type="text/css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">yolynn</a>
    </h1>
    
        
            <a  class="header-right-icon "
                href="/#about">
        
        
            <i class="fa fa-lg fa-head.png"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/head.png"/>
            </a>
            <span class="sidebar-profile-name">yolynn</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/yolynn-bird" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://weibo.com/zxl20zxl" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-weibo"></i>
                    <span class="sidebar-button-desc">global.weibo</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://stackoverflow.com/users/2662962/yolynn" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://twitter.com/zxl20zxl" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://www.instagram.com/yolynn.bird" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-instagram"></i>
                    <span class="sidebar-button-desc">global.instagram</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://dribbble.com/yolynn" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-dribbble"></i>
                    <span class="sidebar-button-desc">global.dribbble</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="http://yolynn.com/2010/04/22/weixin/"
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-weixin"></i>
                    <span class="sidebar-button-desc">global.weixin</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://www.zhihu.com/people/yolynn" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-flickr"></i>
                    <span class="sidebar-button-desc">global.zhihu</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto://zxl20zxl@gmail.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/08/10/ios_thread/">
                            iOSå¤šçº¿ç¨‹åŸºç¡€åˆ°è¿›é˜¶
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-08-10T18:15:02+08:00">
	
		    Aug 10, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="å­¦ä¹ iOSå¤šçº¿ç¨‹éœ€è¦ä¼šä»€ä¹ˆï¼Ÿ">å­¦ä¹ iOSå¤šçº¿ç¨‹éœ€è¦ä¼šä»€ä¹ˆï¼Ÿ</h2><p>è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸­å¹¶å‘æ‰§è¡Œçš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­æ‰§è¡Œè¿ç®—çš„æœ€å°å•ä½ã€‚</p>
<h2 id="iOSå¤šçº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ">iOSå¤šçº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</h2><h4 id="Pthreads">Pthreads</h4><p>åŸºäºCè¯­è¨€ï¼Œç§»æ¤æ€§å¼º</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &#60;pthread.h&#62;&#10;pthread_t thread;&#10;pthread_create(&#38;thread, NULL, start, NULL);</span><br></pre></td></tr></table></figure>
<h4 id="NSThread">NSThread</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run:) object:nil];&#10;[thread start];</span><br></pre></td></tr></table></figure>
<h4 id="GCD">GCD</h4><h6 id="å¼‚æ­¥">å¼‚æ­¥</h6><p>å¼‚æ­¥å’ŒåŒæ­¥æœ€å¤§çš„åŒºåˆ«åœ¨äºå¼‚æ­¥ä¸ä¼š<strong>é˜»å¡å½“å‰çº¿ç¨‹</strong>ï¼Œæ˜¯å¦ç­‰å¾…blockå®Œæˆåè¿”å›</p>
<h6 id="é˜Ÿåˆ—">é˜Ÿåˆ—</h6><ol>
<li>ä¸²è¡Œé˜Ÿåˆ—<ul>
<li>ä¸»é˜Ÿåˆ—                 dispatch_get_main_queue()</li>
<li>è‡ªå®šä¹‰é˜Ÿåˆ—            dispatch_queue_create(â€œç§æœ‰ä¸²è¡Œâ€, DISPATCH_QUEUE_SERIAL)</li>
</ul>
</li>
<li>å¹¶è¡Œé˜Ÿåˆ—<ul>
<li>å…¨å±€å¹¶å‘é˜Ÿåˆ—            dispatch_get_global_queue()</li>
<li>è‡ªå®šä¹‰é˜Ÿåˆ—            dispatch_queue_create(â€œç§æœ‰å¹¶è¡Œâ€, DISPATCH_QUEUE_CONCURRENT)</li>
</ul>
</li>
</ol>
<h6 id="ä»»åŠ¡">ä»»åŠ¡</h6><ol>
<li>dispatch_sync(queue, block)</li>
<li>dispatch_async(queue, block)</li>
<li>dispatch_barrier_sync(queue, block)<ul>
<li>ä¼ å…¥çš„queueæ˜¯è‡ªå®šä¹‰DISPATCH_QUEUE_CONCURRENT queue</li>
<li>é˜»å¡queue </li>
<li>æ‰§è¡Œblockå‰çš„ä»»åŠ¡åï¼Œæ‰§è¡Œblockï¼Œè§£é™¤é˜»å¡</li>
</ul>
</li>
<li>dispatch_barrier_async(queue, block)<ul>
<li>ä¼ å…¥çš„queueæ˜¯è‡ªå®šä¹‰DISPATCH_QUEUE_CONCURRENT queue</li>
<li>é˜»å¡queue </li>
<li>é˜»å¡å½“å‰çº¿ç¨‹</li>
</ul>
</li>
</ol>
<h6 id="é˜Ÿåˆ—_+_ä»»åŠ¡">é˜Ÿåˆ— + ä»»åŠ¡</h6><ol>
<li>é˜Ÿåˆ—ç»„<ul>
<li>dispatch_group_create()</li>
<li>dispatch_group_async(group, queue, block)</li>
<li>dispatch_group_notify(group, queue, block)</li>
</ul>
</li>
</ol>
<p><a href="http://tutuge.me/2015/04/03/something-about-gcd/index.html" target="_blank" rel="external">æŸ¥çœ‹æ›´å¤šå…³äºGCDçš„å‘</a></p>
<h4 id="NSOperation_&amp;_NSOperationQueue">NSOperation &amp; NSOperationQueue</h4><p>æ˜¯å¯¹GCDæ›´é«˜ä¸€å±‚çš„å°è£…</p>
<h6 id="NSOperation">NSOperation</h6><ol>
<li>NSInvocationOperation </li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSInvocationOperation *operation = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(run) object:nil];&#10;[operation start];</span><br></pre></td></tr></table></figure>
<ol>
<li>NSBlockOperation</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSBlockOperation *operation = [NSBlockOperation blockOperationWithBlock:^&#123;&#10;      NSLog(@&#34;%@&#34;, [NSThread currentThread]);&#10;  &#125;];&#10;  &#10;//&#28155;&#21152;&#22810;&#20010;Block&#65292;&#25903;&#25345;&#22810;&#32447;&#31243;&#10;for (NSInteger i = 0; i &#60; 5; i++) &#123;&#10;&#9;[operation addExecutionBlock:^&#123;&#10;&#9;NSLog(@&#34;&#31532;%ld&#27425;&#65306;%@&#34;, i, [NSThread currentThread]);&#10;&#9;&#125;];&#10;&#125;&#10;&#10;[operation start];</span><br></pre></td></tr></table></figure>
<h6 id="NSOperationQueue">NSOperationQueue</h6><ol>
<li>ä¸»é˜Ÿåˆ—<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSOperationQueue *queue = [NSOperationQueue mainQueue];</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li>å…¶å®ƒé˜Ÿåˆ—</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//1.&#21019;&#24314;&#19968;&#20010;&#20854;&#20182;&#38431;&#21015;    &#10;NSOperationQueue *queue = [[NSOperationQueue alloc] init];&#10;&#10;//2.&#21019;&#24314;NSBlockOperation&#23545;&#35937;&#10;NSBlockOperation *operation = [NSBlockOperation blockOperationWithBlock:^&#123;&#10;    NSLog(@&#34;%@&#34;, [NSThread currentThread]);&#10;&#125;];&#10;&#10;//3.&#28155;&#21152;&#22810;&#20010;Block&#10;for (NSInteger i = 0; i &#60; 5; i++) &#123;&#10;    [operation addExecutionBlock:^&#123;&#10;        NSLog(@&#34;&#31532;%ld&#27425;&#65306;%@&#34;, i, [NSThread currentThread]);&#10;    &#125;];&#10;&#125;&#10;&#10;//4.&#38431;&#21015;&#28155;&#21152;&#20219;&#21153;&#10;[queue addOperation:operation];</span><br></pre></td></tr></table></figure>
<ol>
<li>maxConcurrentOperationCount æœ€å¤§å¹¶å‘æ•°</li>
<li>ä»»åŠ¡ä¾èµ–</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//1.&#20219;&#21153;&#19968;&#65306;&#19979;&#36733;&#22270;&#29255;&#10;NSBlockOperation *operation1 = [NSBlockOperation blockOperationWithBlock:^&#123;&#10;    NSLog(@&#34;&#19979;&#36733;&#22270;&#29255; - %@&#34;, [NSThread currentThread]);&#10;    [NSThread sleepForTimeInterval:1.0];&#10;&#125;];&#10;&#10;//2.&#20219;&#21153;&#20108;&#65306;&#25171;&#27700;&#21360;&#10;NSBlockOperation *operation2 = [NSBlockOperation blockOperationWithBlock:^&#123;&#10;    NSLog(@&#34;&#25171;&#27700;&#21360;   - %@&#34;, [NSThread currentThread]);&#10;    [NSThread sleepForTimeInterval:1.0];&#10;&#125;];&#10;&#10;//3.&#20219;&#21153;&#19977;&#65306;&#19978;&#20256;&#22270;&#29255;&#10;NSBlockOperation *operation3 = [NSBlockOperation blockOperationWithBlock:^&#123;&#10;    NSLog(@&#34;&#19978;&#20256;&#22270;&#29255; - %@&#34;, [NSThread currentThread]);&#10;    [NSThread sleepForTimeInterval:1.0];&#10;&#125;];&#10;&#10;//4.&#35774;&#32622;&#20381;&#36182;&#10;[operation2 addDependency:operation1];      //&#20219;&#21153;&#20108;&#20381;&#36182;&#20219;&#21153;&#19968;&#10;[operation3 addDependency:operation2];      //&#20219;&#21153;&#19977;&#20381;&#36182;&#20219;&#21153;&#20108;&#10;&#10;//5.&#21019;&#24314;&#38431;&#21015;&#24182;&#21152;&#20837;&#20219;&#21153;&#10;NSOperationQueue *queue = [[NSOperationQueue alloc] init];&#10;[queue addOperations:@[operation3, operation2, operation1] waitUntilFinished:NO];</span><br></pre></td></tr></table></figure>
<h2 id="ä¸ºä»€ä¹ˆè¦ç”¨iOSå¤šçº¿ç¨‹ï¼Ÿ">ä¸ºä»€ä¹ˆè¦ç”¨iOSå¤šçº¿ç¨‹ï¼Ÿ</h2><ol>
<li>æ˜“äºè°ƒåº¦ã€æé«˜å¹¶å‘ã€å……åˆ†å‘æŒ¥ç¡¬ä»¶å¤šæ ¸ä¼˜åŠ¿</li>
</ol>
<h2 id="iOSå¤šçº¿ç¨‹æ€ä¹ˆç”¨ï¼Ÿ">iOSå¤šçº¿ç¨‹æ€ä¹ˆç”¨ï¼Ÿ</h2><h4 id="æ­»é”">æ­»é”</h4><h6 id="ä¸ºä»€ä¹ˆæ­»é”">ä¸ºä»€ä¹ˆæ­»é”</h6><p>ä½¿ç”¨åŒæ­¥å‡½æ•°æ·»åŠ ä»»åŠ¡é˜»å¡å½“å‰çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹ä»»åŠ¡éœ€ç­‰å¾…æ·»åŠ çš„ä»»åŠ¡ï¼Œè¢«æ·»åŠ åˆ°é˜Ÿåˆ—çš„ä»»åŠ¡å…·æœ‰FIFOæ€§è´¨ï¼Œå®ƒä¹Ÿåœ¨ç­‰å¾…å½“å‰çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œï¼Œè¿›å…¥ç›¸äº’ç­‰å¾…é€ æˆæ­»é”ã€‚</p>
<h6 id="æ€ä¹ˆé¿å…æ­»é”">æ€ä¹ˆé¿å…æ­»é”</h6><ol>
<li>åŒæ­¥è½¬å¼‚æ­¥ï¼Œé‡Šæ”¾é˜»å¡</li>
<li>ä»»åŠ¡æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—æˆ–å…¶å®ƒé˜Ÿåˆ—</li>
</ol>
<h4 id="çº¿ç¨‹å®‰å…¨">çº¿ç¨‹å®‰å…¨</h4><p>å¤šä¸ªçº¿ç¨‹æŠ¢å åŒä¸€èµ„æºè¿›è¡Œæ“ä½œï¼Œå¦‚ä½•é¿å…ï¼Ÿ</p>
<ol>
<li>@synchronized(self)</li>
<li>dispatch_semaphore<ul>
<li>dispatch_semaphore_create(1)<ul>
<li>dispatch_semaphore_signal </li>
<li>dispatch_semaphore_wait</li>
</ul>
</li>
</ul>
</li>
<li>NSLock</li>
<li>pthread_mutex </li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)runSemaphore &#123;&#10;    &#10;    // 2, dispatch_semaphore&#10;    dispatch_semaphore_t signal = dispatch_semaphore_create(1);&#10;    dispatch_time_t overtime = dispatch_time(DISPATCH_TIME_NOW, 3 * NSEC_PER_SEC);&#10;    &#10;    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;&#10;        &#10;        dispatch_semaphore_wait(signal, overtime);  //signal value - 1&#10;        NSLog(@&#34;&#25805;&#20316;1&#65292;&#24320;&#22987;&#34;);&#10;        sleep(2);&#10;        NSLog(@&#34;&#25805;&#20316;1&#65292;&#32467;&#26463;&#34;);&#10;        dispatch_semaphore_signal(signal); //signal value + 1&#10;    &#125;);&#10;    &#10;    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;&#10;        &#10;        sleep(1);&#10;        dispatch_semaphore_wait(signal, overtime);  //signal value = 0  to  1&#10;        NSLog(@&#34;&#25805;&#20316;2&#65292;&#24320;&#22987;&#34;);&#10;        dispatch_semaphore_signal(signal);  //signal value = 2&#10;    &#125;);&#10;    &#10;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å»¶è¿Ÿæ‰§è¡Œ">å»¶è¿Ÿæ‰§è¡Œ</h4><h6 id="perform">perform</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self performSelector:@selector(run:) withObject:@&#34;abc&#34; afterDelay:3];</span><br></pre></td></tr></table></figure>
<h6 id="GCD-1">GCD</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#21019;&#24314;&#38431;&#21015;&#10;dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);&#10;// &#35774;&#32622;&#24310;&#26102;&#65292;&#21333;&#20301;&#31186;&#10;double delay = 3; &#10;&#10;dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delay * NSEC_PER_SEC)), queue, ^&#123;&#10;    // 3&#31186;&#21518;&#38656;&#35201;&#25191;&#34892;&#30340;&#20219;&#21153;&#10;&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="NSTimer">NSTimer</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[NSTimer scheduledTimerWithTimeInterval:3.0 target:self selector:@selector(run:) userInfo:@&#34;abc&#34; repeats:NO];</span><br></pre></td></tr></table></figure>
<h4 id="å•ä¾‹_dispatch_once">å•ä¾‹ dispatch_once</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@interface Tool : NSObject &#60;NSCopying&#62;&#10;&#10;+ (instancetype)sharedTool;&#10;&#10;@end&#10;&#10;@implementation Tool&#10;&#10;static id _instance;&#10;&#10;+ (instancetype)sharedTool &#123;&#10;    static dispatch_once_t onceToken;&#10;    dispatch_once(&#38;onceToken, ^&#123;&#10;        _instance = [[Tool alloc] init];&#10;    &#125;);&#10;&#10;    return _instance;&#10;&#125;&#10;&#10;@end</span><br></pre></td></tr></table></figure>
<h4 id="å…¶å®ƒçº¿ç¨‹å›ä¸»çº¿ç¨‹">å…¶å®ƒçº¿ç¨‹å›ä¸»çº¿ç¨‹</h4><ul>
<li>NSThread</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self performSelectorOnMainThread:@selector(run) withObject:nil waitUntilDone:NO];</span><br></pre></td></tr></table></figure>
<ul>
<li>GCD</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;&#10;&#10;&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>NSOperation</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;&#10;&#10;&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="iOSå¤šçº¿ç¨‹çš„å®é™…åº”ç”¨">iOSå¤šçº¿ç¨‹çš„å®é™…åº”ç”¨</h2><h4 id="XXä¼š">XXä¼š</h4><h4 id="Xèœ‚">Xèœ‚</h4>
                    
                        
                    
                    
                        <p>
                            <a href="/2015/08/10/ios_thread/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/07/20/ios_arc_mrc/">
                            iOSå†…å­˜ç®¡ç†åŸºç¡€åˆ°è¿›é˜¶
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-07-20T18:15:02+08:00">
	
		    Jul 20, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="å­¦ä¹ å†…å­˜ç®¡ç†éœ€è¦ä¼šä»€ä¹ˆï¼Ÿ">å­¦ä¹ å†…å­˜ç®¡ç†éœ€è¦ä¼šä»€ä¹ˆï¼Ÿ</h2><p>æ€è€ƒä¸‹ï¼Œè‹¹æœä¸ºä»€ä¹ˆæœ‰äº†MRCåˆè®¾è®¡ARCï¼Ÿ</p>
<p>iOSå†…å­˜ç®¡ç†æ¨¡å‹</p>
<ol>
<li>è‡ªåŠ¨åƒåœ¾æ”¶é›†ï¼ˆiOSç¯å¢ƒä¸æ”¯æŒï¼‰</li>
<li>æ‰‹åŠ¨å¼•ç”¨è®¡æ•°å’Œè‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆMRCï¼‰</li>
<li>è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARCï¼‰  </li>
</ol>
<h2 id="å†…å­˜ç®¡ç†æ˜¯ä»€ä¹ˆï¼Ÿ">å†…å­˜ç®¡ç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><h3 id="MRC">MRC</h3><h4 id="å¼•ç”¨è®¡æ•°å™¨">å¼•ç”¨è®¡æ•°å™¨</h4><ol>
<li>å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œä¹Ÿå¯è¯´æœ‰å¤šå°‘äººæ­£åœ¨ç”¨è¿™ä¸ªå¯¹è±¡</li>
<li>åˆå§‹åŒ–æ—¶ä¸º1<ul>
<li>åˆ›å»ºå¹¶æŒæœ‰å¯¹è±¡ï¼šalloc new copy mutableCopy</li>
<li>æŒæœ‰å¯¹è±¡ï¼šretain</li>
</ul>
</li>
<li>è®¡æ•°ä¸º0æ—¶ï¼Œå¯¹è±¡å ç”¨çš„å†…å­˜è¢«ç³»ç»Ÿå›æ”¶</li>
</ol>
<h4 id="å¼•ç”¨è®¡æ•°å™¨æ“ä½œ">å¼•ç”¨è®¡æ•°å™¨æ“ä½œ</h4><ol>
<li>retain +1</li>
<li>release -1</li>
<li>retainCount æ˜¾ç¤ºè®¡æ•°</li>
</ol>
<h4 id="deallocæ–¹æ³•">deallocæ–¹æ³•</h4><ol>
<li>[super dealloc];ä¸€å®šåœ¨æœ€åä¸€è¡Œ</li>
<li>ä¸èƒ½ç›´æ¥è°ƒç”¨</li>
<li>ä¸€æ—¦å¯¹è±¡è¢«å›æ”¶ï¼Œç»§ç»­ä½¿ç”¨ä¼šé‡æŒ‡é’ˆ</li>
</ol>
<h4 id="é‡æŒ‡é’ˆ_&amp;_ç©ºæŒ‡é’ˆ">é‡æŒ‡é’ˆ &amp; ç©ºæŒ‡é’ˆ</h4><ol>
<li>é‡æŒ‡é’ˆå³ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†â€œ<strong>åƒµå°¸å¯¹è±¡</strong>ï¼ˆä¸èƒ½å†ä½¿ç”¨çš„å¯¹è±¡ï¼‰â€</li>
<li>ç»™é‡æŒ‡é’ˆå‘æ¶ˆæ¯æŠ¥é”™ï¼šEXC_BAD_ACCESS</li>
<li>é¿å…é‡æŒ‡é’ˆå‘æ¶ˆæ¯æŠ¥é”™ï¼Œå¯¹è±¡é‡Šæ”¾åï¼Œå°†æŒ‡é’ˆç½®ä¸ºç©ºæŒ‡é’ˆ<ul>
<li>ç©ºæŒ‡é’ˆå³æ²¡æœ‰æŒ‡å‘ä»»ä½•å­˜å‚¨ç©ºé—´ï¼ˆå­˜çš„nilï¼‰</li>
<li>å‘ç©ºæŒ‡é’ˆå‘é€æ¶ˆæ¯æ²¡æœ‰ä»»ä½•ååº”</li>
</ul>
</li>
</ol>
<h4 id="MRC_å•ä¸ªå¯¹è±¡ç®¡ç†">MRC å•ä¸ªå¯¹è±¡ç®¡ç†</h4><ol>
<li>è°åˆ›å»º(alloc copy)ï¼Œè°release</li>
<li>è°retain, è°release</li>
</ol>
<h4 id="MRC_å¤šä¸ªå¯¹è±¡ç®¡ç†">MRC å¤šä¸ªå¯¹è±¡ç®¡ç†</h4><p><img src="https://www.processon.com/chart_image/5864740be4b0e069269f1e34.png" alt=""></p>
<ol>
<li>setteræ–¹æ³•</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setRoom:(Room *)room &#123;&#10;&#9;// &#21482;&#26377;&#25151;&#38388;&#19981;&#21516;&#26102;&#25165;&#38656;&#35201;release &#21644; retain&#10;&#9;if (_room != room) &#123;&#10;&#9;&#9;// &#23558;&#20197;&#21069;&#30340;&#25151;&#38388;release -1&#10;&#9;&#9;[_room release];&#10;&#9;&#9;&#10;&#9;&#9;_room = [room retain];&#10;&#9;&#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MRC_@propertyå‚æ•°">MRC @propertyå‚æ•°</h4><ol>
<li>æˆå‘˜å˜é‡å‰åŠ ä¸Š<strong>@property</strong>ï¼Œè‡ªåŠ¨ç”Ÿæˆ<strong>åŸºæœ¬</strong>çš„setter/getter</li>
<li>propertyåŠ ä¸Š<strong>retain</strong>ï¼Œè‡ªåŠ¨ç”Ÿæˆ<strong>æœ‰å†…å­˜ç®¡ç†</strong>çš„setter/getter</li>
<li>propertyåŠ ä¸Š<strong>assign</strong>ï¼Œè‡ªåŠ¨ç”ŸæˆåŸºæœ¬çš„setter/getterï¼Œ<strong>é»˜è®¤</strong>ä»€ä¹ˆéƒ½ä¸åŠ å°±æ˜¯assign</li>
</ol>
<h4 id="MRC_å¾ªç¯å¼•ç”¨">MRC å¾ªç¯å¼•ç”¨</h4><ul>
<li>å½“ä¸¤ç«¯äº’ç›¸å¼•ç”¨æ—¶ï¼Œåº”è¯¥ä¸€ç«¯ç”¨retainï¼Œä¸€ç«¯ç”¨assign</li>
</ul>
<h4 id="autoreleasepool">autoreleasepool</h4><ol>
<li><strong>[p autorelease]</strong> ç»™på‘é€ä¸€æ¡autoreleaseæ¶ˆæ¯ï¼Œå°†pæ”¾åˆ°autoreleasepoolï¼Œåœ¨autoreleasepoolé‡Šæ”¾æ—¶åšä¸€æ¬¡releaseæ“ä½œ</li>
<li>autoreleaseæ–¹æ³•è¿”å›å¯¹è±¡æœ¬èº«ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¼šå˜åŒ–</li>
</ol>
<h6 id="autoreleasepool_å¥½å¤„">autoreleasepool å¥½å¤„</h6><ol>
<li>ä¸ç”¨å…³å¿ƒé‡Šæ”¾æ—¶é—´</li>
<li>ä¸ç”¨å…³å¿ƒä»€ä¹ˆæ—¶å€™è°ƒç”¨release</li>
</ol>
<h6 id="autoreleasepool_åŸç†">autoreleasepool åŸç†</h6><p>autoreleasepoolå®é™…ä¸Šåªæ˜¯æŠŠå¯¹releaseçš„è°ƒç”¨å»¶è¿Ÿäº†</p>
<ol>
<li>å£°æ˜__autoreleasepoolæ—¶ï¼Œæ„é€ å‡½æ•°<strong>__AtAutoreleasePool()</strong>æ‰§è¡Œï¼Œå³<strong>atautoreleasepoolobj = objc_autoreleasePoolPush()</strong></li>
<li>å‡ºäº†å½“å‰ä½œç”¨åŸŸæ—¶ï¼Œææ„å‡½æ•°<strong>~__AtAutoreleasePool()</strong>æ‰§è¡Œï¼Œå³<strong>objc_autoreleasePoolPop(atautoreleasepoolobj)</strong></li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> __declspec(dllimport) <span class="function"><span class="keyword">void</span> * <span class="title">objc_autoreleasePoolPush</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> __declspec(dllimport) <span class="function"><span class="keyword">void</span> <span class="title">objc_autoreleasePoolPop</span><span class="params">(<span class="keyword">void</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> __AtAutoreleasePool &#123;</span><br><span class="line">  __AtAutoreleasePool() &#123;atautoreleasepoolobj = objc_autoreleasePoolPush();&#125;</span><br><span class="line">  ~__AtAutoreleasePool() &#123;objc_autoreleasePoolPop(atautoreleasepoolobj);&#125;</span><br><span class="line">  <span class="keyword">void</span> * atautoreleasepoolobj;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool;&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* @autoreleasepool */</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> *atautoreleasepoolobj = objc_autoreleasePoolPush();</span><br><span class="line">    <span class="comment">// ç”¨æˆ·ä»£ç ï¼Œæ‰€æœ‰æ¥æ”¶åˆ° autorelease æ¶ˆæ¯çš„å¯¹è±¡ä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ª autoreleasepool ä¸­</span></span><br><span class="line">    objc_autoreleasePoolPop(atautoreleasepoolobj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>PUSHæ“ä½œ</li>
</ul>
<p>æ¯è°ƒç”¨ä¸€æ¬¡ push æ“ä½œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ autoreleasepool ï¼Œå³å¾€ AutoreleasePoolPage ä¸­æ’å…¥ä¸€ä¸ª POOL_SENTINEL ï¼Œå¹¶ä¸”è¿”å›æ’å…¥çš„ POOL_SENTINEL çš„å†…å­˜åœ°å€ã€‚</p>
<ul>
<li>Autoreleaseæ“ä½œ</li>
</ul>
<p>å®ƒè·Ÿ push æ“ä½œçš„å®ç°éå¸¸ç›¸ä¼¼ã€‚åªä¸è¿‡ push æ“ä½œæ’å…¥çš„æ˜¯ä¸€ä¸ª POOL_SENTINEL ï¼Œè€Œ autorelease æ“ä½œæ’å…¥çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„ autoreleased å¯¹è±¡</p>
<ul>
<li>POPæ“ä½œ</li>
</ul>
<p>pop å‡½æ•°çš„å…¥å‚å°±æ˜¯ push å‡½æ•°çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯ POOL_SENTINEL çš„å†…å­˜åœ°å€ï¼Œå³ pool token ã€‚å½“æ‰§è¡Œ pop æ“ä½œæ—¶ï¼Œå†…å­˜åœ°å€åœ¨ pool token ä¹‹åçš„æ‰€æœ‰ autoreleased å¯¹è±¡éƒ½ä¼šè¢« release</p>
<h6 id="autoreleasepool_åˆ›å»ºå’Œä½¿ç”¨">autoreleasepool åˆ›å»ºå’Œä½¿ç”¨</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#26041;&#24335;1&#10;NSAutoreleasePool *autoreleasePool = [[NSAutoreleasePool alloc] init];&#10;Person *p = [[[Person alloc] init] autorelease];&#10;[autoreleasePool drain];&#10;&#10;// &#26041;&#24335;2&#10;@autoreleasepool&#10;&#123; // &#21019;&#24314;&#19968;&#20010;&#33258;&#21160;&#37322;&#25918;&#27744;&#10;        Person *p = [[Person new] autorelease];&#10;        // &#23558;&#20195;&#30721;&#20889;&#21040;&#36825;&#37324;&#23601;&#25918;&#20837;&#20102;&#33258;&#21160;&#37322;&#25918;&#27744;&#10;&#125; // &#38144;&#27585;&#33258;&#21160;&#37322;&#25918;&#27744;(&#20250;&#32473;&#27744;&#23376;&#20013;&#25152;&#26377;&#23545;&#35937;&#21457;&#36865;&#19968;&#26465;release&#28040;&#24687;)</span><br></pre></td></tr></table></figure>
<h6 id="autoreleasepool_æ³¨æ„">autoreleasepool æ³¨æ„</h6><ul>
<li>å¹¶ä¸æ˜¯æ”¾åˆ°autoreleasepoolä»£ç ä¸­,éƒ½ä¼šè‡ªåŠ¨åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± </li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;&#10;    // &#22240;&#20026;&#27809;&#26377;&#35843;&#29992; autorelease &#26041;&#27861;,&#25152;&#20197;&#23545;&#35937;&#27809;&#26377;&#21152;&#20837;&#21040;&#33258;&#21160;&#37322;&#25918;&#27744;&#10;    Person *p = [[Person alloc] init];&#10;    [p run];&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>autoreleaseæ˜¯ä¸€ä¸ªæ–¹æ³•, åªæœ‰åœ¨autoreleasepoolä¸­è°ƒç”¨æ‰æœ‰æ•ˆ</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;&#10;&#125;&#10;// &#27809;&#26377;&#19982;&#20043;&#23545;&#24212;&#30340;&#33258;&#21160;&#37322;&#25918;&#27744;, &#21482;&#26377;&#22312;&#33258;&#21160;&#37322;&#25918;&#27744;&#20013;&#35843;&#29992;autorelease&#25165;&#20250;&#25918;&#21040;&#37322;&#25918;&#27744;&#10;Person *p = [[[Person alloc] init] autorelease];&#10;[p run];&#10;&#10;// &#27491;&#30830;&#20889;&#27861;&#10;@autoreleasepool &#123;&#10;    Person *p = [[[Person alloc] init] autorelease];&#10; &#125;&#10;&#10;// &#27491;&#30830;&#20889;&#27861;&#10;Person *p = [[Person alloc] init];&#10;@autoreleasepool &#123;&#10;    [p autorelease];&#10;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="autoreleasepool_åµŒå¥—">autoreleasepool åµŒå¥—</h6><ol>
<li>AutoreleasePool ä»¥ <strong>æ ˆ</strong>å½¢å¼å­˜åœ¨</li>
<li>æ ˆåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œè°ƒç”¨autoreleaseä¼šå°†å¯¹è±¡æ”¾åˆ°<strong>æ ˆé¡¶çš„è‡ªåŠ¨é‡Šæ”¾æ± </strong></li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123; // &#26632;&#24213;&#33258;&#21160;&#37322;&#25918;&#27744;&#10;    @autoreleasepool &#123;&#10;        @autoreleasepool &#123; // &#26632;&#39030;&#33258;&#21160;&#37322;&#25918;&#27744;&#10;            Person *p = [[[Person alloc] init] autorelease];&#10;        &#125;&#10;        Person *p = [[[Person alloc] init] autorelease];&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="autoreleasepool_forå¾ªç¯">autoreleasepool forå¾ªç¯</h6><ol>
<li>å°½é‡é¿å…å¯¹å¤§å†…å­˜ä½¿ç”¨autorelease</li>
<li>ä¸è¦æŠŠforå¾ªç¯æ”¾åœ¨@autoreleasepoolä¹‹é—´ï¼Œä¼šé€ æˆå†…å­˜å³°å€¼ä¸Šå‡</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#20869;&#23384;&#26292;&#28072;&#10;@autoreleasepool &#123;&#10;    for (int i = 0; i &#60; 99999; ++i) &#123;&#10;        Person *p = [[[Person alloc] init] autorelease];&#10;    &#125;&#10;&#125;&#10;&#10;// &#20869;&#23384;&#19981;&#20250;&#26292;&#28072;&#10;for (int i = 0; i &#60; 99999; ++i) &#123;&#10;    @autoreleasepool &#123;&#10;        Person *p = [[[Person alloc] init] autorelease];&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="autoreleasepool_é”™è¯¯ç”¨æ³•">autoreleasepool é”™è¯¯ç”¨æ³•</h6><ol>
<li>ä¸èƒ½è¿ç»­è°ƒç”¨autorelease</li>
<li>è°ƒç”¨autoreleaseååˆè°ƒç”¨release</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;&#10; // &#38169;&#35823;&#20889;&#27861;, &#36807;&#24230;&#37322;&#25918;&#10;    Person *p = [[[[Person alloc] init] autorelease] autorelease];&#10; &#125;&#10; &#10; @autoreleasepool &#123;&#10;    Person *p = [[[Person alloc] init] autorelease];&#10;    [p release]; // &#38169;&#35823;&#20889;&#27861;, &#36807;&#24230;&#37322;&#25918;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ARC">ARC</h3><ol>
<li>Automatic Reference Countingï¼Œè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼Œè‡ªiOS5 LLVM3.0å¼•å…¥</li>
<li>è§£å†³äº†å¹¿å¤§iOSå¼€å‘è€…æ‰€æ†æ¨çš„æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„éº»çƒ¦</li>
<li>é€šè¿‡ç”Ÿæˆæ­£ç¡®çš„ä»£ç å»è‡ªåŠ¨é‡Šæ”¾æˆ–è€…ä¿æŒå¯¹è±¡ï¼Œæˆ‘ä»¬å®Œå…¨ä¸ç”¨æ‹…å¿ƒç¼–è¯‘å™¨ä¼šå‡ºé”™</li>
</ol>
<h4 id="ARC_åˆ¤æ–­æ˜¯å¦éœ€è¦é‡Šæ”¾">ARC åˆ¤æ–­æ˜¯å¦éœ€è¦é‡Šæ”¾</h4><p>åªè¦è¿˜æœ‰ä¸€ä¸ªå¼ºæŒ‡é’ˆæŒ‡å‘å¯¹è±¡ï¼Œå¯¹è±¡å°±ä¼šä¿å­˜åœ¨å†…å­˜ä¸­</p>
<ol>
<li>å¼ºæŒ‡é’ˆ  è¢«__strongä¿®é¥°</li>
<li>å¼±æŒ‡é’ˆ  è¢«__weakä¿®é¥°</li>
</ol>
<h4 id="ARC_æ³¨æ„">ARC æ³¨æ„</h4><ol>
<li>ä¸èƒ½è°ƒç”¨release</li>
<li>ä¸èƒ½è°ƒç”¨autorelease</li>
<li>ä¸èƒ½è°ƒç”¨[super dealloc]</li>
</ol>
<h4 id="ARC_å•ä¸ªå¯¹è±¡ç®¡ç†">ARC å•ä¸ªå¯¹è±¡ç®¡ç†</h4><ul>
<li>å±€éƒ¨å˜é‡é‡Šæ”¾ï¼Œå¯¹è±¡éšä¹‹é‡Šæ”¾</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, const char * argv[]) &#123;&#10;   @autoreleasepool &#123;&#10;        Person *p = [[Person alloc] init];&#10;    &#125; // &#25191;&#34892;&#21040;&#36825;&#19968;&#34892;&#23616;&#37096;&#21464;&#37327;p&#37322;&#25918;&#10;    // &#30001;&#20110;&#27809;&#26377;&#24378;&#25351;&#38024;&#25351;&#21521;&#23545;&#35937;, &#25152;&#20197;&#23545;&#35937;&#20063;&#37322;&#25918;&#10;    return 0;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ¸…ç©ºæŒ‡é’ˆï¼Œå¯¹è±¡éšä¹‹é‡Šæ”¾</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, const char * argv[]) &#123;&#10;   @autoreleasepool &#123;&#10;        Person *p = [[Person alloc] init];&#10;        p = nil; // &#25191;&#34892;&#21040;&#36825;&#19968;&#34892;, &#30001;&#20110;&#27809;&#26377;&#24378;&#25351;&#38024;&#25351;&#21521;&#23545;&#35937;, &#25152;&#20197;&#23545;&#35937;&#34987;&#37322;&#25918;&#10;    &#125;&#10;    return 0;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é»˜è®¤æ¸…ç©ºæ‰€æœ‰æŒ‡é’ˆéƒ½æ˜¯å¼ºæŒ‡é’ˆ</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, const char * argv[]) &#123;&#10;   @autoreleasepool &#123;&#10;        // p1&#21644;p2&#37117;&#26159;&#24378;&#25351;&#38024;&#10;        Person *p1 = [[Person alloc] init];&#10;        __strong Person *p2 = [[Person alloc] init];&#10;    &#125;&#10;    return 0;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¼±æŒ‡é’ˆéœ€è¦æ˜ç¡®è¯´æ˜ï¼ˆ<strong>åƒä¸‡ä¸è¦ä½¿ç”¨å¼±æŒ‡é’ˆä¿å­˜æ–°åˆ›å»ºçš„å¯¹è±¡</strong>ï¼‰</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, const char * argv[]) &#123;&#10;   @autoreleasepool &#123;&#10;        // p&#26159;&#24369;&#25351;&#38024;, &#23545;&#35937;&#20250;&#34987;&#31435;&#21363;&#37322;&#25918;&#10;        __weak Person *p1 = [[Person alloc] init];&#10;    &#125;&#10;    return 0;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ARC_å¤šä¸ªå¯¹è±¡ç®¡ç†">ARC å¤šä¸ªå¯¹è±¡ç®¡ç†</h4><ul>
<li>ARCå’ŒMRCä¸€æ ·ï¼Œæƒ³æ‹¥æœ‰æŸä¸ªå¯¹è±¡éœ€è¦ç”¨å¼ºæŒ‡é’ˆæŒ‡å‘ï¼Œä½†æ˜¯ä¸éœ€è¦è°ƒç”¨deallocä¸­release</li>
</ul>
<h4 id="ARC_@property">ARC @property</h4><ul>
<li>strong : ç”¨äºOCå¯¹è±¡ï¼Œç›¸å½“äºMRCä¸­çš„retain</li>
<li>weak : ç”¨äºOCå¯¹è±¡ï¼Œç›¸å½“äºMRCä¸­çš„assign</li>
<li>assign : ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œè·ŸMRCä¸­çš„assignä¸€æ ·</li>
</ul>
<h4 id="ARC_å¾ªç¯å¼•ç”¨">ARC å¾ªç¯å¼•ç”¨</h4><ul>
<li>Aæ‹¥æœ‰Bï¼ŒBä¹Ÿæ‹¥æœ‰Aï¼Œé‚£ä¹ˆå¿…é¡»ä¸€æ–¹ä½¿ç”¨å¼±æŒ‡é’ˆ</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@interface Person : NSObject&#10;@property (nonatomic, strong) Dog *dog;&#10;@end&#10;&#10;@interface Dog : NSObject&#10;// &#38169;&#35823;&#20889;&#27861;, &#24490;&#29615;&#24341;&#29992;&#20250;&#23548;&#33268;&#20869;&#23384;&#27844;&#38706;&#10;//@property (nonatomic, strong) Person *owner;&#10;&#10;// &#27491;&#30830;&#20889;&#27861;, &#24403;&#22914;&#26524;&#20445;&#23384;&#23545;&#35937;&#24314;&#35758;&#20351;&#29992;weak&#10;@property (nonatomic, weak) Person *owner;&#10;@end</span><br></pre></td></tr></table></figure>
<h2 id="ä¸ºä»€ä¹ˆç”¨å†…å­˜ç®¡ç†?">ä¸ºä»€ä¹ˆç”¨å†…å­˜ç®¡ç†?</h2><h4 id="NSThread_&amp;_NSRunLoop_&amp;_NSAutoreleasePool">NSThread &amp; NSRunLoop &amp; NSAutoreleasePool</h4><ol>
<li>æ¯ä¸ªçº¿ç¨‹ï¼ˆåŒ…æ‹¬ä¸»çº¿ç¨‹ï¼‰éƒ½æ‹¥æœ‰ä¸€ä¸ªä¸“å±çš„NSRunLoopï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨åˆ›å»º</li>
<li>ä¸»çº¿ç¨‹çš„NSRunLoopå¯¹è±¡ï¼ˆåŒ…æ‹¬ç³»ç»Ÿçº§åˆ«çš„å…¶å®ƒçº¿ç¨‹ï¼‰çš„æ¯ä¸ªevent loopå¼€å§‹å‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªautoreleasepoolï¼Œå¹¶åœ¨event loopç»“æŸæ—¶drain</li>
<li>æ¯ä¸ªautoreleasepoolå¯¹åº”ä¸”åªå¯¹åº”ä¸€ä¸ªçº¿ç¨‹</li>
</ol>
<h2 id="å†…å­˜ç®¡ç†æ€ä¹ˆç”¨ï¼Ÿ">å†…å­˜ç®¡ç†æ€ä¹ˆç”¨ï¼Ÿ</h2><p>è¿™äº›æƒ…å†µéœ€è¦æ‰‹åŠ¨æ·»åŠ autoreleasepoolï¼š</p>
<ol>
<li>ç¼–å†™çš„ç¨‹åºä¸æ˜¯åŸºäºUIæ¡†æ¶çš„ï¼Œæ¯”å¦‚å‘½ä»¤è¡Œå·¥å…·</li>
<li>ç¼–å†™çš„å¾ªç¯ä¸­åˆ›å»ºäº†å¤§é‡çš„ä¸´æ—¶å¯¹è±¡  </li>
<li>åˆ›å»ºäº†ä¸€ä¸ªè¾…åŠ©çº¿ç¨‹</li>
</ol>
<h2 id="å†…å­˜ç®¡ç†å®é™…åº”ç”¨">å†…å­˜ç®¡ç†å®é™…åº”ç”¨</h2><h4 id="é¡¹ç›®">é¡¹ç›®</h4><ol>
<li>YYKit ï¼šè§£å†³å¾ªç¯ä¸­åˆ›å»ºçš„å¤§é‡ä¸´æ—¶å¯¹è±¡</li>
<li>AFNetworkingï¼š åˆ›å»ºäº†è¾…åŠ©çº¿ç¨‹</li>
<li>XXä¼š æ··ç¼–æ—¶ï¼Œ æ ‡æ³¨MRCæ–‡ä»¶ï¼š-fno-objc-arc</li>
</ol>
<h4 id="ARC_å®ä¾‹">ARC å®ä¾‹</h4><ol>
<li>ARCæƒ³è¦ä¸»åŠ¨é‡Šæ”¾ï¼Œæœ€å¥½æ˜¯æå‰ç½®ä¸ºnil</li>
<li>ARCä¸‹è·å–å¼•ç”¨è®¡æ•°<ul>
<li>KVC  [obj valueForKey:@â€retainCountâ€] </li>
<li>ç§æœ‰API _objc_rootRetainCount(obj)</li>
<li>CFGetRetainCount((__bridge CFTypeRef)(obj))</li>
</ul>
</li>
</ol>
<h4 id="MRC_å®ä¾‹">MRC å®ä¾‹</h4><ol>
<li>ä¸‹é¢è¿™ç§æƒ…å†µä¼šæŠ¥é”™å—ï¼Ÿï¼ˆæ³¨æ„è®¡ç®—retainCountï¼‰</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">	YLAutorelease *obj = [[YLAutorelease alloc] init];      <span class="comment">//1</span></span><br><span class="line">    _tableView = [[<span class="built_in">UITableView</span> alloc] init];                <span class="comment">//1</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"obj retainCount:%ld"</span>, [obj retainCount]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"tableView retainCount:%ld"</span>, [_tableView retainCount]);</span><br><span class="line">    </span><br><span class="line">    [obj performSelector:<span class="keyword">@selector</span>(test) withObject:_tableView afterDelay:<span class="number">1</span>];   <span class="comment">//obj 2 , tableView 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"obj retainCount:%ld"</span>, [obj retainCount]);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"tableView retainCount:%ld"</span>, [_tableView retainCount]);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    [obj release];</span></span><br><span class="line"><span class="comment">//    [_tableView release];</span></span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:obj selector:<span class="keyword">@selector</span>(test) object:_tableView];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"obj retainCount:%ld"</span>, [obj retainCount]);       <span class="comment">//1</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"tableView retainCount:%ld"</span>, [_tableView retainCount]);  <span class="comment">//1</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>NSStringçš„å¼•ç”¨è®¡æ•°æ˜¯éšæœºå€¼ï¼ŒNSMutableStringçš„å¼•ç”¨è®¡æ•°æ˜¯æ­£å¸¸å€¼</p>
<ul>
<li>NSStringçš„classæ˜¯__NSCFConstantStringï¼Œå­—ç¬¦ä¸²å¸¸é‡</li>
<li>NSMutableStringçš„classæ˜¯__NSCFStringï¼Œæœ‰å¼•ç”¨è®¡æ•°</li>
</ul>
</li>
<li><p>å¯¹äºå­—ç¬¦ä¸²å¸¸é‡ã€NSNumberåšå¸¸é‡æ—¶ï¼Ÿ</p>
<ul>
<li>retain å’Œ releaseéƒ½ä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºç³»ç»Ÿä¸ä¼šå›æ”¶ï¼Œä¹Ÿä¸ä¼šå¯¹å…¶åšå¼•ç”¨è®¡æ•°</li>
</ul>
</li>
<li><p>stringWithFormatåˆ›å»ºçš„stringï¼Ÿ</p>
<ul>
<li>ä¸ºå˜é‡ï¼Œæ‰€ä»¥ä¼šæœ‰å¼•ç”¨è®¡æ•°</li>
<li>ç°åœ¨è¿”å›çš„å·²ç»æ˜¯å¸¸é‡ï¼Œè§åé¢çš„ä¾‹å­</li>
</ul>
</li>
<li><p>stringWithStringåˆ›å»ºçš„string?</p>
<ul>
<li>å–å†³äºå®ƒåé¢çš„stringå¯¹è±¡ï¼Œå¦‚æœæ˜¯å¸¸é‡åˆ™ä¸åšè®¡æ•°ï¼Œå¦‚æœæ˜¯å˜é‡åˆ™åšè®¡æ•°</li>
</ul>
</li>
<li><p>é™¤äº†alloc new copy mutableCopy retainæ˜¾ç¤ºå¢åŠ retainCountä»¥å¤–è¿˜æœ‰å“ªäº›çœ‹ä¸åˆ°çš„èƒ½å¤Ÿå¢åŠ å¼•ç”¨è®¡æ•°çš„æ“ä½œï¼Ÿ</p>
<ul>
<li>å®¹å™¨ç±»arrayã€dic addObjectï¼›releaseæ—¶ï¼Œé‡Œé¢çš„æˆå‘˜éƒ½ä¼šreleaseä¸€æ¬¡ï¼Œå’Œautorelease poolä¸€è‡´</li>
<li>addsubview, å› ä¸ºviewæœ‰æ ˆ(subviews)ï¼ŒåŠ å…¥æ ˆä¸­retainCount+1</li>
<li>navcontrollerçš„push, å› ä¸ºnavæœ‰æ ˆ(viewcontrollers)ï¼ŒåŠ å…¥æ ˆä¸­retainCount+1</li>
<li>performSelector è°ƒç”¨æ—¶targetå’Œinfoéƒ½ä¼šåŠ 1ï¼Œç»“æŸæ—¶å‡1</li>
</ul>
</li>
<li><p>è‹¹æœä¸æ¨èä½¿ç”¨retainCountæ–¹æ³•ï¼Œå› ä¸ºä»–å¯¹ç¨‹åºæœ¬èº«æ²¡æœ‰ä½œç”¨ï¼ŒretainCountå¯èƒ½æ°¸è¿œä¸ä¼šåå›0ï¼Œæœ‰æ—¶å€™ç³»ç»Ÿä¼šä¼˜åŒ–å¯¹è±¡çš„é‡Šæ”¾è¡Œä¸ºï¼Œåœ¨ä¿ç•™è®¡æ•°è¿˜æ˜¯1çš„æ—¶å€™å°±é‡Šæ”¾äº†ã€‚</p>
</li>
<li><p>å‡ ä¸ªcopy, mutableCopyçš„ä¾‹å­</p>
</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line">   <span class="built_in">NSMutableString</span> *str = [[<span class="built_in">NSMutableString</span> alloc] init];</span><br><span class="line">   <span class="built_in">NSMutableString</span> *str2 = [[<span class="built_in">NSMutableString</span> alloc] init];</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%ld, %ld"</span>, [str retainCount], [str2 retainCount]);<span class="comment">//1,1</span></span><br><span class="line">   </span><br><span class="line">   str2 = [str <span class="keyword">copy</span>];         <span class="comment">//copyè¿”å›ä¸€ä¸ªä¸å¯å˜å¯¹è±¡å±äºå¸¸é‡</span></span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%ld, %ld"</span>, [str retainCount], [str2 retainCount]);<span class="comment">//1,-1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] init];</span><br><span class="line"><span class="built_in">NSString</span> *str2 = [[<span class="built_in">NSString</span> alloc] init];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld, %ld"</span>, [str retainCount], [str2 retainCount]); <span class="comment">//-1,-1</span></span><br><span class="line"></span><br><span class="line">str2 = [str <span class="keyword">copy</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld, %ld"</span>, [str retainCount], [str2 retainCount]);<span class="comment">//-1,-1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"abc%@"</span>, <span class="string">@"hehe"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *str2 = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"bbc%@"</span>, <span class="string">@"hehe"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld, %ld"</span>, [str retainCount], [str2 retainCount]); <span class="comment">//-1,-1</span></span><br><span class="line"></span><br><span class="line">str2 = [str mutableCopy];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld, %ld"</span>, [str retainCount], [str2 retainCount]);<span class="comment">//-1,1</span></span><br></pre></td></tr></table></figure>
<ol>
<li>blockå†…å­˜ç®¡ç†ï¼Œè¯¦è§åç»­æ–‡ç« </li>
</ol>

                    
                        
                    
                    
                        <p>
                            <a href="/2015/07/20/ios_arc_mrc/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/06/20/c_pointer/">
                            æŒ‡é’ˆåŸºç¡€åˆ°è¿›é˜¶
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-06-20T18:15:02+08:00">
	
		    Jun 20, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="å­¦ä¹ æŒ‡é’ˆéœ€è¦ä¼šä»€ä¹ˆï¼Ÿ">å­¦ä¹ æŒ‡é’ˆéœ€è¦ä¼šä»€ä¹ˆï¼Ÿ</h2><p>å¦‚ä½•å®Œå…¨ç†è§£ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œè®°ä½ä¸€æ¡åŸåˆ™ï¼š</p>
<ul>
<li>ä»<strong>å˜é‡å</strong>å¤„èµ·ï¼Œæ ¹æ®<strong>è¿ç®—ç¬¦ä¼˜å…ˆçº§</strong>ç»“åˆï¼Œä¸€æ­¥ä¸€æ­¥åˆ†æ</li>
</ul>
<p>ä¸¾å‡ ä¸ªğŸŒ°ï¼š</p>
<ol>
<li>int p;    <ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸intç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æ•´å‹å˜é‡</strong></li>
</ul>
</li>
<li>int *p;    <ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸*ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æŒ‡é’ˆ</strong>ï¼Œ</li>
<li>å†ä¸intç»“åˆï¼Œè¯´æ˜<strong>æŒ‡é’ˆæŒ‡å‘intå‹</strong>ï¼Œ</li>
<li>æ‰€ä»¥pæ˜¯è¿”å›intå‹æ•°æ®çš„æŒ‡é’ˆ</li>
</ul>
</li>
<li>int p[3];<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸[]ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æ•°ç»„</strong>ï¼Œ</li>
<li>å†ä¸intç»“åˆï¼Œè¯´æ˜<strong>[]é‡Œé¢æ˜¯intå‹</strong>,</li>
<li>æ‰€ä»¥pæ˜¯è¿”å›intå‹æ•°æ®çš„æ•°ç»„</li>
</ul>
</li>
<li>int *p[3];<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸[]ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æ•°ç»„</strong>ï¼Œ</li>
<li>å†ä¸*ç»“åˆï¼Œè¯´æ˜<strong>[]é‡Œé¢æ˜¯æŒ‡é’ˆå‹</strong>ï¼Œ</li>
<li>å†ä¸intç»“åˆï¼Œè¯´æ˜<strong>æŒ‡é’ˆæŒ‡å‘å†…å®¹æ˜¯intå‹</strong>ï¼Œ</li>
<li>æ‰€ä»¥pæ˜¯ç”±è¿”å›intå‹æ•°æ®çš„æŒ‡é’ˆç»„æˆçš„æ•°ç»„</li>
</ul>
</li>
<li>int (*p)[3];<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸*ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æŒ‡é’ˆ</strong>ï¼Œ</li>
<li>å†ä¸[]ç»“åˆï¼Œè¯´æ˜<strong>æŒ‡é’ˆæŒ‡å‘[]å‹</strong>ï¼Œ</li>
<li>å†ä¸intç»“åˆï¼Œè¯´æ˜<strong>[]é‡Œæ˜¯intå‹</strong>ï¼Œ</li>
<li>æ‰€ä»¥pæ˜¯æŒ‡å‘ç”±intå‹æ•°æ®ç»„æˆçš„æ•°ç»„çš„æŒ‡é’ˆ</li>
</ul>
</li>
<li>int **p;<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸*ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æŒ‡é’ˆ</strong>ï¼Œ</li>
<li>å†ä¸*ç»“åˆï¼Œè¯´æ˜<strong>æŒ‡é’ˆæŒ‡å‘æŒ‡é’ˆå‹</strong>ï¼Œ</li>
<li>å†ä¸intç»“åˆï¼Œè¯´æ˜<strong>äºŒçº§æŒ‡é’ˆæŒ‡å‘intå‹</strong>,</li>
<li>æ‰€ä»¥pæ˜¯äºŒçº§æŒ‡é’ˆ</li>
</ul>
</li>
<li>int p(int);<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸()ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>å‡½æ•°</strong>ï¼Œ</li>
<li>åˆ†æ()é‡Œé¢ï¼Œå‡½æ•°æœ‰ä¸€ä¸ª<strong>intå‹å‚æ•°</strong>,</li>
<li>å†ä¸intç»“åˆï¼Œå‡½æ•°<strong>è¿”å›ç±»å‹æ˜¯int</strong></li>
</ul>
</li>
<li>int (*p)(int);<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸*ç»“åˆï¼Œè¯´æ˜pæ˜¯<strong>æŒ‡é’ˆ</strong>,</li>
<li>å†ä¸()ç»“åˆï¼Œè¯´æ˜<strong>æŒ‡é’ˆæŒ‡å‘å‡½æ•°</strong>ï¼Œ</li>
<li>åˆ†æ()é‡Œé¢ï¼Œå‡½æ•°æœ‰ä¸€ä¸ª<strong>intå‹å‚æ•°</strong>,</li>
<li>å†ä¸intç»“åˆï¼Œå‡½æ•°<strong>è¿”å›ç±»å‹æ˜¯int</strong>,</li>
<li>æ‰€ä»¥pæ˜¯æŒ‡å‘æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºæ•´æ•°çš„å‡½æ•°çš„æŒ‡é’ˆ</li>
</ul>
</li>
<li>int *(*p(int))[3];<ul>
<li>ä»på¼€å§‹ï¼Œå…ˆä¸()ç»“åˆï¼Œè¯´æ˜pæ˜¯ä¸€ä¸ª<strong>å‡½æ•°</strong>,</li>
<li>åˆ†æ()é‡Œé¢ï¼Œå‡½æ•°æœ‰ä¸€ä¸ª<strong>intå‹å‚æ•°</strong>ï¼Œ</li>
<li>å†ä¸*ç»“åˆï¼Œå‡½æ•°<strong>è¿”å›ç±»å‹æ˜¯æŒ‡é’ˆ</strong>ï¼Œ</li>
<li>å†ä¸[]ç»“åˆï¼Œè¯´æ˜è¿”å›çš„<strong>æŒ‡é’ˆæŒ‡å‘[]</strong>,</li>
<li>å†ä¸*ç»“åˆï¼Œè¯´æ˜<strong>[]é‡Œæ˜¯æŒ‡é’ˆ</strong>ï¼Œ</li>
<li>å†ä¸intç»“åˆï¼Œè¯´æ˜æŒ‡é’ˆ<strong>æŒ‡å‘çš„æ˜¯intå‹</strong>ï¼Œ</li>
<li>æ‰€ä»¥pæ˜¯ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªintå‹ä¸”è¿”å›ä¸€ä¸ªæŒ‡å‘æ•´å‹æŒ‡é’ˆå˜é‡ç»„æˆçš„æ•°ç»„çš„æŒ‡é’ˆå˜é‡çš„å‡½æ•°</li>
</ul>
</li>
</ol>
<h2 id="æŒ‡é’ˆæ˜¯ä»€ä¹ˆï¼Ÿ">æŒ‡é’ˆæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æŒ‡é’ˆæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œå®ƒå­˜å‚¨çš„æ•°å€¼è¢«è§£é‡Šæˆå†…å­˜é‡Œçš„ä¸€ä¸ªåœ°å€</p>
<p>å…ˆå£°æ˜å‡ ä¸ªæŒ‡é’ˆğŸŒ°ï¼š</p>
<ol>
<li>int *ptr;</li>
<li>char *ptr;</li>
<li>int **ptr;</li>
<li>int (*ptr)[3];</li>
<li>int *(*ptr)[4] </li>
</ol>
<h4 id="æŒ‡é’ˆçš„ç±»å‹">æŒ‡é’ˆçš„ç±»å‹</h4><p>æŠŠæŒ‡é’ˆåå­—å»æ‰ï¼Œå‰©ä¸‹éƒ¨åˆ†å°±æ˜¯æŒ‡é’ˆç±»å‹</p>
<h4 id="æŒ‡å‘çš„ç±»å‹">æŒ‡å‘çš„ç±»å‹</h4><p>æŠŠæŒ‡é’ˆåå’Œåå­—å·¦è¾¹çš„*å»æ‰ï¼Œå‰©ä¸‹éƒ¨åˆ†å°±æ˜¯æŒ‡é’ˆæŒ‡å‘çš„ç±»å‹</p>
<ul>
<li>æŒ‡é’ˆçš„ç±»å‹ï¼ˆæŒ‡é’ˆæœ¬èº«çš„ç±»å‹ï¼‰å’ŒæŒ‡é’ˆæŒ‡å‘çš„ç±»å‹æ˜¯<strong>ä¸¤ä¸ªæ¦‚å¿µ</strong></li>
</ul>
<h4 id="æŒ‡é’ˆçš„å€¼_â€”_æˆ–å«æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒº">æŒ‡é’ˆçš„å€¼ â€” æˆ–å«æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒº</h4><p>åœ¨32ä½æ“ä½œç³»ç»Ÿé‡Œï¼ŒæŒ‡é’ˆéƒ½æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒºå°±æ˜¯ä»æŒ‡é’ˆçš„å€¼ä»£è¡¨çš„é‚£ä¸ª<strong>å†…å­˜åœ°å€å¼€å§‹</strong>ï¼Œé•¿åº¦ä¸º<strong>sizeof(æŒ‡é’ˆæŒ‡å‘çš„ç±»å‹)</strong>çš„ä¸€ç‰‡å†…å­˜åŒº</p>
<ul>
<li>æˆ‘ä»¬è¯´ä¸€ä¸ªæŒ‡é’ˆçš„å€¼æ˜¯XXï¼Œç›¸å½“äºè¯´æŒ‡é’ˆæŒ‡å‘äº†ä»¥XXä¸ºé¦–åœ°å€çš„ä¸€ç‰‡å†…å­˜åŒºåŸŸ</li>
<li>æˆ‘ä»¬è¯´ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†æŸå—å†…å­˜åŒºåŸŸï¼Œç›¸å½“äºè¯´æŒ‡é’ˆçš„å€¼æ˜¯è¿™å—å†…å­˜åŒºåŸŸçš„é¦–åœ°å€</li>
</ul>
<h4 id="æŒ‡é’ˆæœ¬èº«å æ®çš„å†…å­˜åŒºåŸŸ">æŒ‡é’ˆæœ¬èº«å æ®çš„å†…å­˜åŒºåŸŸ</h4><p><strong>sizeof(æŒ‡é’ˆçš„ç±»å‹)</strong>ï¼Œ32ä½ç³»ç»Ÿé‡Œï¼ŒæŒ‡é’ˆå æ®4ä¸ªå­—èŠ‚</p>
<h2 id="ä¸ºä»€ä¹ˆç”¨æŒ‡é’ˆï¼Ÿ">ä¸ºä»€ä¹ˆç”¨æŒ‡é’ˆï¼Ÿ</h2><p>Cè¯­è¨€çš„ç²¾åå’Œå”¯ä¸€çš„éš¾ç‚¹å°±æ˜¯æŒ‡é’ˆï¼Œæå®šæŒ‡é’ˆç­‰äºæå®šäº†Cè¯­è¨€</p>
<p>æŒ‡é’ˆ -&gt; Cè¯­è¨€ -&gt; C++ -&gt; æ•°æ®ç»“æ„ -&gt; ç®—æ³• -&gt; èŒƒå‹ç¼–ç¨‹ä¸STLå’ŒSTLæºç å‰–æ</p>
<h2 id="æŒ‡é’ˆæ€ä¹ˆç”¨ï¼Ÿ">æŒ‡é’ˆæ€ä¹ˆç”¨ï¼Ÿ</h2><h4 id="æŒ‡é’ˆçš„ç®—æœ¯è¿ç®—">æŒ‡é’ˆçš„ç®—æœ¯è¿ç®—</h4><p>æŒ‡é’ˆå¯ä»¥åŠ ä¸Šæˆ–å‡å»ä¸€ä¸ªæ•´æ•°</p>
<ul>
<li>å’Œæ•°å€¼çš„åŠ å‡è¿ç®—ä¸ä¸€æ ·ï¼Œä»¥å•å…ƒä¸ºå•ä½</li>
<li>ä¸¤ä¸ªæŒ‡é’ˆä¸èƒ½è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœä¸çŸ¥é“æŒ‡å‘ä½•å¤„</li>
<li>ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥è¿›è¡Œå‡æ³•è¿ç®—ï¼Œä½†æ˜¯ç±»å‹å¿…é¡»ç›¸åŒï¼Œä¸€èˆ¬ç”¨äºæ•°ç»„</li>
</ul>
<p>ğŸŒ°1ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> a[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> *ptr = (<span class="keyword">int</span> *)a;  <span class="comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ä¼šæ”¹å˜açš„ç±»å‹</span></span><br><span class="line">ptr++;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">æŒ‡é’ˆptråŠ äº†<span class="number">1</span>ï¼Œç¼–è¯‘å™¨å¤„ç†ï¼šptrçš„å€¼åŠ ä¸Šäº†<span class="keyword">sizeof</span>(<span class="keyword">int</span>)ï¼Œåœ¨<span class="number">32</span>ä½ç¨‹åºé‡Œï¼Œæ˜¯åŠ äº†<span class="number">4</span>ï¼Œå› ä¸º<span class="keyword">int</span>å æ®<span class="number">4</span>ä¸ªå­—èŠ‚ã€‚</span><br><span class="line"></span><br><span class="line">ğŸŒ°<span class="number">2</span>ï¼š</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> *ptr = <span class="built_in">array</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">	(*ptr)++;</span><br><span class="line">	ptr++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å„ä¸ªå•å…ƒçš„å€¼åŠ 1ï¼Œæ¯æ¬¡å¾ªç¯éƒ½å°†æŒ‡é’ˆptråŠ 1ä¸ªå•å…ƒï¼Œæ‰€ä»¥æ¯æ¬¡å¾ªç¯éƒ½èƒ½è®¿é—®åˆ°ä¸‹ä¸€ä¸ªå•å…ƒã€‚</p>
<h4 id="è¿ç®—ç¬¦_&amp;_å’Œ_*">è¿ç®—ç¬¦ &amp; å’Œ *</h4><p>&amp;æ˜¯å–åœ°å€è¿ç®—ç¬¦ï¼Œ*æ˜¯é—´æ¥è¿ç®—ç¬¦</p>
<ul>
<li>&amp;açš„è¿ç®—ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆçš„ç±»å‹æ˜¯açš„ç±»å‹åŠ ä¸ª*ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„ç±»å‹æ˜¯açš„ç±»å‹ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„åœ°å€æ˜¯açš„åœ°å€</li>
<li><em>pçš„ç»“æœäº”èŠ±å…«é—¨ï¼Œ\</em>pçš„ç»“æœæ˜¯pæ‰€æŒ‡å‘çš„ä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿çš„ç‰¹ç‚¹ï¼šå®ƒçš„ç±»å‹æ˜¯pæŒ‡å‘çš„ç±»å‹ï¼Œå®ƒå ç”¨çš„åœ°å€æ˜¯pæŒ‡å‘çš„åœ°å€</li>
</ul>
<p>ğŸŒ°1ï¼š </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a=<span class="number">12</span>; <span class="keyword">int</span> b; <span class="keyword">int</span> *p; <span class="keyword">int</span> **ptr;</span><br><span class="line"></span><br><span class="line">p = &amp;a; <span class="comment">//&amp;açš„ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç±»å‹æ˜¯int *, æŒ‡å‘çš„ç±»å‹æ˜¯int, æŒ‡å‘çš„åœ°å€æ˜¯açš„åœ°å€</span></span><br><span class="line"></span><br><span class="line">*p = <span class="number">24</span>; <span class="comment">//*pçš„ç»“æœï¼Œå®ƒçš„ç±»å‹æ˜¯intï¼Œå®ƒå ç”¨çš„åœ°å€æ˜¯pæŒ‡å‘çš„åœ°å€ï¼Œ*på°±æ˜¯å˜é‡a</span></span><br><span class="line"></span><br><span class="line">ptr = &amp;p; <span class="comment">//&amp;pçš„ç»“æœæ˜¯æŒ‡é’ˆï¼Œç±»å‹æ˜¯pçš„ç±»å‹åŠ ä¸ª*ï¼Œè¿™é‡Œæ˜¯int **ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘çš„ç±»å‹æ˜¯pçš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯int *ï¼Œè¯¥æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€å°±æ˜¯æŒ‡é’ˆ p è‡ªå·±çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line">*ptr = &amp;b; <span class="comment">//*ptr æ˜¯ä¸ªæŒ‡é’ˆ,&amp;b çš„ç»“æœä¹Ÿæ˜¯ä¸ªæŒ‡é’ˆ,ä¸”è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ç±»å‹å’Œæ‰€æŒ‡å‘çš„ç±»å‹æ˜¯ä¸€æ ·çš„,æ‰€ä»¥ç”¨&amp;b æ¥ç»™*ptr èµ‹å€¼å°±æ˜¯æ¯«æ— é—®é¢˜çš„äº†</span></span><br><span class="line"></span><br><span class="line">**ptr = <span class="number">34</span>; <span class="comment">//*ptr çš„ç»“æœæ˜¯ ptr æ‰€æŒ‡å‘çš„ä¸œè¥¿,åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆ, å¯¹è¿™ä¸ªæŒ‡é’ˆå†åšä¸€æ¬¡*è¿ç®—,ç»“æœæ˜¯ä¸€ä¸ª int ç±»å‹çš„å˜é‡ã€‚</span></span><br></pre></td></tr></table></figure>
<h4 id="æŒ‡é’ˆè¡¨è¾¾å¼">æŒ‡é’ˆè¡¨è¾¾å¼</h4><p>ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ˜¯æŒ‡é’ˆï¼Œå³æŒ‡é’ˆè¡¨è¾¾å¼</p>
<p>ğŸŒ°1ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a,b;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span> *pa;</span><br><span class="line">pa = &amp;a;				<span class="comment">//&amp;a</span></span><br><span class="line"><span class="keyword">int</span> **ptr = &amp;pa;    <span class="comment">//&amp;pa</span></span><br><span class="line">*ptr = &amp;b;          <span class="comment">//*ptr å’Œ &amp;b </span></span><br><span class="line">pa = <span class="built_in">array</span>;</span><br><span class="line">pa++;					<span class="comment">//pa</span></span><br></pre></td></tr></table></figure>
<p>å½“ä¸€ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼çš„ç»“æœæŒ‡é’ˆå·²ç»æ˜ç¡®åœ°å…·æœ‰äº†æŒ‡é’ˆè‡ªèº«å  æ®çš„å†…å­˜çš„è¯,è¿™ä¸ªæŒ‡é’ˆè¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ªå·¦å€¼,å¦åˆ™å°±ä¸æ˜¯ä¸€ä¸ªå·¦å€¼</p>
<h4 id="æŒ‡é’ˆå’Œæ•°ç»„">æŒ‡é’ˆå’Œæ•°ç»„</h4><p>æ•°ç»„åå¯ä»¥çœ‹ä½œä¸€ä¸ªæŒ‡é’ˆ</p>
<p>ğŸŒ°1ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intarray[<span class="number">10</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;,value;value=<span class="built_in">array</span>[<span class="number">0</span>];		<span class="comment">//å¯å†™æˆï¼š value = *array;</span>value=<span class="built_in">array</span>[<span class="number">3</span>];		<span class="comment">//å¯å†™æˆï¼š	value = *(array+3);</span>value=<span class="built_in">array</span>[<span class="number">4</span>];		<span class="comment">//å¯å†™æˆï¼š value = *(array+4);</span></span><br></pre></td></tr></table></figure>
<p>æ•°ç»„åarrayä»£è¡¨æ•°ç»„æœ¬èº«ï¼Œç±»å‹æ˜¯int[10]ï¼Œå¦‚æœæŠŠarrayçœ‹ä½œæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æ•°ç»„çš„ç¬¬0ä¸ªå•å…ƒï¼Œç±»å‹æ˜¯int <em>ï¼Œ æ‰€æŒ‡å‘çš„ç±»å‹æ˜¯æ˜¯æ•°ç»„å•å…ƒçš„ç±»å‹å³intï¼Œå› æ­¤\</em>array ç­‰äº 0 å°±ä¸€ç‚¹ä¹Ÿä¸ å¥‡æ€ªäº†ã€‚åŒç†,array+3 æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„ç¬¬ 3 ä¸ªå•å…ƒçš„æŒ‡é’ˆ,æ‰€ä»¥ *(array+3)ç­‰äº 3ã€‚å…¶å®ƒä¾æ­¤ç±»æ¨</p>
<h4 id="æŒ‡é’ˆå’Œç»“æ„ç±»å‹">æŒ‡é’ˆå’Œç»“æ„ç±»å‹</h4><p>å¯ä»¥å£°æ˜ä¸€ä¸ªæŒ‡å‘ç»“æ„ç±»å¯¹è±¡çš„æŒ‡é’ˆ</p>
<p>ğŸŒ°1ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> MyStruct &#123;</span><br><span class="line">	<span class="keyword">int</span> a;</span><br><span class="line">	<span class="keyword">int</span> b;</span><br><span class="line">	<span class="keyword">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> MyStruct ss = &#123;<span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> MyStruct *ptr = &amp;ss;  <span class="comment">//å£°æ˜ä¸€ä¸ªæŒ‡å‘ç»“æ„å¯¹è±¡ssçš„æŒ‡é’ˆï¼Œå®ƒçš„ç±»å‹æ˜¯MyStruct *ï¼Œå®ƒæŒ‡å‘çš„ç±»å‹æ˜¯MyStruct</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *pstr = (<span class="keyword">int</span> *)&amp;ss; <span class="comment">//å£°æ˜ä¸€ä¸ªæŒ‡å‘ç»“æ„å¯¹è±¡ssçš„æŒ‡é’ˆï¼Œä½†æ˜¯pstrå’Œå®ƒè¢«æŒ‡å‘çš„ç±»å‹ptræ˜¯ä¸åŒçš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  ptr æ¥è®¿é—® ss çš„ä¸‰ä¸ªæˆå‘˜å˜é‡</span></span><br><span class="line">ptr-&gt;a;  <span class="comment">//æŒ‡å‘è¿ç®—ç¬¦</span></span><br><span class="line">ptr-&gt;b;</span><br><span class="line">ptr-&gt;c;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  pstr æ¥è®¿é—® ss çš„ä¸‰ä¸ªæˆå‘˜å˜é‡</span></span><br><span class="line">*pstr;</span><br><span class="line">*(pstr + <span class="number">1</span>);</span><br><span class="line">*(pstr + <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<h4 id="æŒ‡é’ˆå’Œå‡½æ•°">æŒ‡é’ˆå’Œå‡½æ•°</h4><p>å¯ä»¥å£°æ˜ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</p>
<p>ğŸŒ°1ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fun1</span><span class="params">(<span class="keyword">char</span> *, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> (*pfun1)(<span class="keyword">char</span> *, <span class="keyword">int</span>);</span><br><span class="line"></span><br><span class="line">pfun1 = fun1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a = (*pfun1)(<span class="string">"abcdefg"</span>, <span class="number">7</span>);  <span class="comment">//é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡é’ˆä½œä¸ºå‡½æ•°çš„å½¢å‚ï¼Œå‡½æ•°è°ƒç”¨ä¸­ï¼Œç”¨æŒ‡é’ˆè¡¨è¾¾å¼æ¥ä½œä¸ºå®å‚</p>
<h4 id="æŒ‡é’ˆç±»å‹è½¬æ¢">æŒ‡é’ˆç±»å‹è½¬æ¢</h4><p>ğŸŒ°1ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> f = <span class="number">12.3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> *fptr = &amp;f;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æƒ³è®©æŒ‡é’ˆ p æŒ‡å‘å®æ•° f</span></span><br><span class="line">p=&amp;f; <span class="comment">//ä¸å¯¹ã€‚å› ä¸ºæŒ‡é’ˆ p çš„ç±»å‹æ˜¯ int *,å®ƒæŒ‡å‘çš„ç±»å‹æ˜¯ int</span></span><br><span class="line"></span><br><span class="line">p=(<span class="keyword">int</span>*)&amp;f; <span class="comment">// å¦‚æœæœ‰ä¸€ä¸ªæŒ‡é’ˆ p,æˆ‘ä»¬éœ€è¦æŠŠå®ƒçš„ç±»å‹å’Œæ‰€æŒ‡å‘çš„ç±»å‹æ”¹ä¸º</span>TYEP *TYPE, é‚£ä¹ˆè¯­æ³•æ ¼å¼æ˜¯: (TYPE *)p;</span><br></pre></td></tr></table></figure>
<p>å¼ºåˆ¶ç±»å‹è½¬æ¢çš„ç»“æœæ˜¯ä¸€ä¸ªæ–°æŒ‡é’ˆ,è¯¥æ–°æŒ‡é’ˆçš„ç±»å‹æ˜¯TYPE *,å®ƒæŒ‡å‘çš„ç±»å‹æ˜¯ TYPE,å®ƒæŒ‡å‘çš„åœ°å€å°±æ˜¯åŸæŒ‡é’ˆæŒ‡å‘çš„åœ°å€ã€‚ <strong>è€ŒåŸæ¥çš„æŒ‡é’ˆ p çš„ä¸€åˆ‡å±æ€§éƒ½æ²¡æœ‰è¢«ä¿®æ”¹ã€‚(åˆ‡è®°)</strong></p>
<h4 id="æŒ‡é’ˆçš„å®‰å…¨é—®é¢˜">æŒ‡é’ˆçš„å®‰å…¨é—®é¢˜</h4><ol>
<li>æŒ‡é’ˆè®¿é—®æ•°ç»„æ—¶ï¼Œä¸è¦è¶…è¿‡æ•°ç»„ä½ç«¯å’Œé«˜ç«¯çš„ç•Œé™</li>
<li>å¼ºåˆ¶ç±»å‹è½¬æ¢ptr1 = (TYPE *)ptr2ä¸­ï¼Œå¦‚æœsizeof(prt2çš„ç±»å‹)å¤§äºsizeof(ptr1çš„ç±»å‹)ï¼Œé‚£ä¹ˆä½¿ç”¨æŒ‡é’ˆptr1è®¿é—®ptr2æ‰€æŒ‡å‘çš„å­˜å‚¨åŒºåŸŸæ˜¯å®‰å…¨çš„</li>
</ol>
<h2 id="æŒ‡é’ˆçš„å®é™…åº”ç”¨">æŒ‡é’ˆçš„å®é™…åº”ç”¨</h2><h4 id="XXä¼š">XXä¼š</h4><h4 id="XXä»“">XXä»“</h4>
                    
                        
                    
                    
                        <p>
                            <a href="/2015/06/20/c_pointer/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2015/06/17/c3p0/">
                            C3P0çš„ä¸¤ç§ç”¨æ³•
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2015-06-17T18:15:02+08:00">
	
		    Jun 17, 2015
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h6 id="background">background</h6><blockquote>
<p>è¿™ç¯‡æ–‡ç« æ‘˜æŠ„è‡ªæˆ‘çš„æ–°æµªåšå®¢ï¼Œ<a href="http://blog.sina.com.cn/s/blog_6c5f4d3c01012gtq.html" target="_blank" rel="external">è¯¦æƒ…é“¾æ¥</a> å› ä¸ºå®ƒä¸€åº¦ä¸ºæˆ‘çš„æ–°æµªåšå®¢ç§¯ç´¯è¶…è¿‡7ä¸‡çš„äººæ°”ï¼Œæ–°æµªåšå®¢å·²ç»è¿œä¸å¦‚æ›¾ç»ï¼Œæ‰€ä»¥æˆ‘æƒ³æŠŠè¿™ç¯‡æ–‡ç« ä¿ç•™ä¸‹æ¥ï¼Œä»¥ä¸‹æ˜¯åŸæ–‡</p>
</blockquote>
<h6 id="æ–¹æ³•ä¸€ï¼š">æ–¹æ³•ä¸€ï¼š</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package   C3P0; </span><br><span class="line">import   java.sql.Connection; </span><br><span class="line">import   java.sql.SQLException; </span><br><span class="line">import   java.beans.PropertyVetoException; </span><br><span class="line">import   com.mchange.v2.c3p0.ComboPooledDataSource; </span><br><span class="line">public   class   DBPool&#123;       </span><br><span class="line">   private   static   DBPool   dbPool;       </span><br><span class="line">   private   ComboPooledDataSource   dataSource;     </span><br><span class="line">	</span><br><span class="line">   static   &#123;       </span><br><span class="line">           dbPool=new   DBPool();       </span><br><span class="line">   &#125;       </span><br><span class="line">   </span><br><span class="line">   public   DBPool()&#123;       </span><br><span class="line">           try   &#123;       </span><br><span class="line">                   dataSource=new   ComboPooledDataSource();       </span><br><span class="line">                   dataSource.setUser( "id ");       </span><br><span class="line">                   dataSource.setPassword( "pw ");       </span><br><span class="line">                   dataSource.setJdbcUrl( "jdbc:mysql://127.0.0.1:3306/test? </span><br><span class="line">	</span><br><span class="line">autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=GB2312 "); </span><br><span class="line">                   dataSource.setDriverClass( "com.mysql.jdbc.Driver "); </span><br><span class="line">                   dataSource.setInitialPoolSize(2); </span><br><span class="line">                   dataSource.setMinPoolSize(1); </span><br><span class="line">                   dataSource.setMaxPoolSize(10); </span><br><span class="line">                   dataSource.setMaxStatements(50); </span><br><span class="line">                   dataSource.setMaxIdleTime(60);       </span><br><span class="line">           &#125;   catch   (PropertyVetoException   e)   &#123;       </span><br><span class="line">               throw   new   RuntimeException(e);       </span><br><span class="line">           &#125;       </span><br><span class="line">   &#125;       </span><br><span class="line">	</span><br><span class="line">   public   final   static   DBPool   getInstance()&#123;       </span><br><span class="line">           return   dbPool;       </span><br><span class="line">   &#125;       </span><br><span class="line">	</span><br><span class="line">   public   final   Connection   getConnection()   &#123;       </span><br><span class="line">           try   &#123;       </span><br><span class="line">                   return   dataSource.getConnection();       </span><br><span class="line">           &#125;   catch   (SQLException   e)   &#123;       </span><br><span class="line">                   throw   new   RuntimeException( "æ— æ³•ä»æ•°æ®æºè·å–è¿æ¥ ",e);       </span><br><span class="line">           &#125;       </span><br><span class="line">   &#125;     </span><br><span class="line">   </span><br><span class="line">   public   static   void   main(String[]   args)   throws   SQLException   &#123; </span><br><span class="line">Connection   con   =   null; </span><br><span class="line">try   &#123; </span><br><span class="line">con   =   DBPool.getInstance().getConnection(); </span><br><span class="line">&#125;   catch   (Exception   e)&#123; </span><br><span class="line">&#125;   finally   &#123; </span><br><span class="line">if   (con   !=   null) </span><br><span class="line">con.close(); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="æ–¹æ³•äºŒï¼š">æ–¹æ³•äºŒï¼š</h6><pre><code>åŸæ¥ä¸çŸ¥é“ä½¿ç”¨c3p0 æ˜¯å¦‚æ­¤çš„ç®€å•ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨<span class="keyword">properties</span> æ–‡ä»¶å»é…ç½®c3p0ï¼Œä½†æ€»æ˜¯è¿æ¥ä¸ä¸Šæ•°æ®åº“ï¼Œåæ¥è°ƒè¯•æ‰å‘ç°ComboPooledDataSource è¿™ä¸ªå¯¹è±¡çš„å±æ€§æ²¡æœ‰è¢«è®¾ç½®æˆåŠŸï¼Œæˆ‘æ˜¯å…ˆè·å–äº†<span class="keyword">properties</span>æ–‡ä»¶çš„å†…å®¹ï¼Œå°è£…åœ¨ä¸€ä¸ª Propertieså¯¹è±¡é‡Œé¢ï¼Œç„¶åç›´æ¥è°ƒç”¨ ComboPooledDataSource çš„ setPropertiesï¼ˆProperties  pï¼‰ æ–¹æ³•æ¥é…ç½®c3p0ï¼Œç¨‹åºæ˜¯æ²¡æœ‰æŠ¥é”™ï¼Œä½†è¿ä¸ä¸Šæ•°æ®åº“ï¼Œè°ƒè¯•å‘ç°å±æ€§éƒ½æ²¡æœ‰è®¾ç½®æˆåŠŸï¼Œåªæ˜¯<span class="keyword">properties</span>è¿™ä¸ªå±æ€§è¢«è®¾ç½®äº†è€Œå·²ï¼Œç»“æœæˆ‘å¯¹æ¯ä¸ªå±æ€§è°ƒç”¨setæ–¹æ³•åå°±è¿æ¥ä¸Šäº†ã€‚ã€‚ã€‚
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionManager</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> ConnectionManager instance;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> ComboPooledDataSource ds;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> String c3p0Properties = <span class="string">"c3p0.properties"</span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="title">ConnectionManager</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Properties p = <span class="keyword">new</span> Properties();</span><br><span class="line">  p.load(<span class="keyword">this</span>.getClass().getResourceAsStream(c3p0Properties));</span><br><span class="line">  ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">  ds.setUser(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setPassword(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setJdbcUrl(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setDriverClass(p.getProperty(<span class="string">"user"</span>));</span><br><span class="line">  ds.setInitialPoolSize(Integer.parseInt(p.getProperty(<span class="string">"initialPoolSize"</span>)));</span><br><span class="line">  ds.setMinPoolSize(Integer.parseInt(p.getProperty(<span class="string">"minPoolSize"</span>)));</span><br><span class="line">  ds.setMaxPoolSize(Integer.parseInt(p.getProperty(<span class="string">"maxPoolSize"</span>)));</span><br><span class="line">  ds.setMaxStatements(Integer.parseInt(p.getProperty(<span class="string">"maxStatements"</span>)));</span><br><span class="line">  ds.setMaxIdleTime(Integer.parseInt(p.getProperty(<span class="string">"maxIdleTime"</span>)));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ConnectionManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">    instance = <span class="keyword">new</span> ConnectionManager();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">final</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">   e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">  DataSources.destroy(ds); <span class="comment">// å…³é—­datasource</span></span><br><span class="line">  <span class="keyword">super</span>.finalize();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>å¦‚æ­¤å°±å¯ä»¥è·å–connectionæ¥åšjdbcæ“ä½œäº†ï¼š
Connection         
conn=ConnectionManager.getInstance().getConnection()<span class="comment">;</span>
è®°å¾—ä½¿ç”¨å®Œåè°ƒç”¨closeæ–¹æ³•ï¼š
conn.close()<span class="comment">;</span>
c3p0 çš„æŸäº›å‚æ•°çš„é…ç½®ä»¥åŠæ„ä¹‰è§å¦å¤–ä¸€ç¯‡æ–‡ç« http://kangzye.blog.163.com/blog/static/<span class="number">3681922320104</span><span class="number">42162576</span>/
</code></pre>
                    
                        
                    
                    
                        <p>
                            <a href="/2015/06/17/c3p0/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        <li class="pagination-prev">
            
                <a class="btn btn--default btn--small" href="/ ">
            
                <i class="fa fa-angle-left text-base icon-mr"></i>
                    <span>NEWER POSTS</span>
            </a>
        </li>
        
        
        <li class="pagination-number">page 2 of 2</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 yolynn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/head.png"/>
        
            <h4 id="about-card-name">yolynn</h4>
        
            <h5 id="about-card-bio"><p>äº‘åœ¨é’å¤©æ°´åœ¨ç“¶</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>vip.com</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                China
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/jquery.js" type="text/javascript"></script>
<script src="/assets/js/jquery.fancybox.js" type="text/javascript"></script>
<script src="/assets/js/jquery.fancybox-thumbs.js" type="text/javascript"></script>
<script src="/assets/js/tranquilpeak.js" type="text/javascript"></script>
<!--SCRIPTS END-->



</html>
